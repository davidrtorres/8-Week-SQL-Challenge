(this["webpackJsonpsqlpad-front-end"]=this["webpackJsonpsqlpad-front-end"]||[]).push([[0],{108:function(e,t,n){e.exports={message:"message_message__2aY5k",error:"message_error__3sZ3a"}},112:function(e,t,n){e.exports={input:"Input_input__2-5S2",danger:"Input_danger__KRM78"}},113:function(e,t,n){e.exports={secondary:"Text_secondary__2My5S",danger:"Text_danger__1MxfX"}},114:function(e,t,n){e.exports={text:"DataNotification_text__1g0fB",AlertIcon:"DataNotification_AlertIcon__3Vace"}},117:function(e,t,n){e.exports={select:"Select_select__2-QYP",danger:"Select_danger__1yZdE"}},118:function(e,t,n){e.exports={textarea:"TextArea_textarea__1bvIz",danger:"TextArea_danger__3V0tn"}},120:function(e,t,n){e.exports={preview:"QueryPreview_preview__29omD",previewQueryName:"QueryPreview_previewQueryName__2uino"}},156:function(e,t,n){e.exports={ListItem:"ListItem_ListItem__DkhCD"}},159:function(e,t,n){e.exports={formExplain:"FormExplain_formExplain__PR_U0"}},160:function(e,t,n){e.exports={danger:"Code_danger__ILwpd"}},165:function(e,t,n){e.exports={logo:"Logo_logo__1vvHH"}},168:function(e,t,n){e.exports={style:"AppHeaderUser_style__3liL0"}},172:function(e,t,n){e.exports={attention:"ConnectionDropdown_attention__1hhgt"}},194:function(e,t,n){e.exports=n(249)},195:function(e,t,n){},202:function(e,t,n){},203:function(e,t,n){},204:function(e,t,n){},22:function(e,t,n){e.exports={toolbar:"QueryResultHeader_toolbar__2UhtN",toolbarItem:"QueryResultHeader_toolbarItem__2Zlye",iconLinkWrapper:"QueryResultHeader_iconLinkWrapper__38hqA",iconLink:"QueryResultHeader_iconLink__6Y_cL"}},227:function(e,t,n){},249:function(e,t,n){"use strict";n.r(t);n(195),n(196),n(197);var a=n(0),r=n.n(a),l=n(55),c=n.n(l),i=n(7),o=n(6),s=n(2),u=n(108),d=n.n(u),m=n(88);const p=Object(m.a)();function f(){const e=Object(a.useState)([]),t=Object(s.a)(e,2),n=t[0],l=t[1];function c(e){l(t=>[...t,e]),setTimeout(()=>l(e=>e.slice(1)),3e3)}if(Object(a.useEffect)(()=>(p.on("message",c),()=>p.off("message",c)),[]),n&&n.length>0){const e=n[n.length-1],t=[d.a.message];return"error"===e.type&&t.push(d.a.error),r.a.createElement("div",{className:t.join(" ")},e.message)}return null}var h=function(e){p.emit("message",{type:"error",message:e})},b=function(e){p.emit("message",{type:"success",message:e})},y=(n(202),n(203),n(204),n(17)),E=n(11),g=n(3),v=n.n(g),w=n(5),x=n(34),C=n.n(x);const k=n(106);window.localforage=C.a;var O=function(){var e=Object(w.a)(v.a.mark((function e(t,n,a){var r,l,c,i,o,u,d,m,p,f;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([C.a.getItem("selectedConnectionId")]);case 3:return r=e.sent,l=Object(s.a)(r,1),c=l[0],i={initialized:!0},1===a.length?i.selectedConnectionId=a[0].id:((o=(n||{}).defaultConnectionId)&&(u=a.find(e=>e.id===o),Boolean(u)&&(i.selectedConnectionId=o)),"string"===typeof c&&(d=a.find(e=>e.id===c),Boolean(d)&&(i.selectedConnectionId=c)),m=k.parse(window.location.search),(p=m.connectionName)&&(d=a.find(e=>e.name===p),Boolean(d)&&(i.selectedConnectionId=d.id)),(f=m.connectionId)&&(d=a.find(e=>e.id===f),Boolean(d)&&(i.selectedConnectionId=d.id))),e.abrupt("return",i);case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0),h("Error initializing application");case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n,a){return e.apply(this,arguments)}}();var j=function(){const e=Object(i.b)("api/app",{dedupingInterval:6e4}).data||{},t=e.config,n=e.currentUser,a=e.adminRegistrationOpen,r=e.version;return t?(window.BASE_URL=t.baseUrl,{config:t,currentUser:n,adminRegistrationOpen:a,version:r}):{}};var S=Object(o.connect)(["initialized"],{initApp:O})((function({children:e,initApp:t,initialized:n}){const l=j(),c=l.config,o=l.currentUser;let s=Object(i.b)("/api/connections").data;return Object(a.useEffect)(()=>{c&&!n&&s&&t(c,s)},[t,c,s,n]),c?c&&!o?r.a.createElement(y.a,{to:{pathname:"/signin"}}):n?e:null:null})),I=n(12),q=n(74),T=n.n(q),_=n(186);n(219);function N(e){let t=e.children,n=Object(I.a)(e,["children"]);return r.a.createElement(_.a,n,t)}var R=r.a.forwardRef((e,t)=>{let n=e.children,a=e.icon,l=e.variant,c=e.htmlType,i=e.tooltip,o=e.disabled,s=e.className,u=Object(I.a)(e,["children","icon","variant","htmlType","tooltip","disabled","className"]);const d=[T.a.btn];"primary"===l?d.push(T.a.primary):"danger"===l?d.push(T.a.danger):"ghost"===l&&d.push(T.a.ghost),s&&d.push(s);const m=r.a.createElement("button",Object.assign({ref:t,className:d.join(" "),type:c,disabled:o},u),a&&r.a.cloneElement(a,{size:18},null),n&&a&&r.a.createElement("span",{style:{width:4}}),n);return!i||o?m:r.a.createElement(N,{label:i},m)}),L=n(112),D=n.n(L);function A(e){let t=e.children,n=e.error,a=e.className,l=Object(I.a)(e,["children","error","className"]);const c=[D.a.input];return n&&c.push(D.a.danger),a&&c.push(a),r.a.createElement("input",Object.assign({className:c.join(" ")},l),t)}function B({size:e=1}){return r.a.createElement("div",{style:{height:8*e}})}n(220);var Q=n(148),z=n.n(Q);function F(e,t,n){return U.apply(this,arguments)}function U(){return(U=Object(w.a)(v.a.mark((function e(t,n,a){var r,l,c,i,o,s,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=window.BASE_URL||"",l={method:t.toUpperCase(),credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","Cache-Control":"no-cache",Expires:"-1",Pragma:"no-cache"}},a&&(l.body=JSON.stringify(a)),c=r+n,r&&"/"!==n.substring(0,1)&&(c=r+"/"+n),e.prev=5,e.next=8,fetch(c,l);case 8:if(!(i=e.sent).redirected){e.next=12;break}return window.location=i.url,e.abrupt("return",{});case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(5),"Network error",h("Network error"),e.abrupt("return",{error:"Network error"});case 19:return e.prev=19,e.next=22,i.json();case 22:if(o=e.sent,s=i.headers.get("Link"),u=s&&z()(s),!i.ok){e.next=27;break}return e.abrupt("return",{data:o,links:u});case 27:return e.abrupt("return",{error:o.detail||o.title||""});case 30:return e.prev=30,e.t1=e.catch(19),console.error(i),e.abrupt("return",{error:"Server responded not ok"});case 34:case"end":return e.stop()}}),e,null,[[5,14],[19,30]])})))).apply(this,arguments)}const P={put:(e,t)=>F("PUT",e,t),delete:e=>F("DELETE",e),post:(e,t)=>F("POST",e,t),get:e=>F("GET",e)};var M=function(){const e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)(!1),i=Object(s.a)(c,2),o=i[0],u=i[1];Object(a.useEffect)(()=>{document.title="SQLPad - Forgot Password"},[]);const d=function(){var e=Object(w.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,P.post("/api/forgot-password",{email:n});case 3:if(!(a=e.sent).error){e.next=6;break}return e.abrupt("return",h(a.error));case 6:u(!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return o?r.a.createElement(y.a,{to:"/password-reset"}):r.a.createElement("div",{style:{width:"300px",textAlign:"center",margin:"100px auto"}},r.a.createElement("form",{onSubmit:d},r.a.createElement("h1",null,"SQLPad"),r.a.createElement(A,{name:"email",type:"email",placeholder:"Email address",onChange:e=>l(e.target.value),required:!0}),r.a.createElement(B,{size:2}),r.a.createElement(R,{style:{width:"100%"},htmlType:"submit",variant:"primary"},"Reset Password")))};function W({children:e}){return r.a.createElement("div",{style:{fontSize:"3rem",width:"100%",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"}},e)}var H=function(){return j().currentUser,Object(a.useEffect)(()=>{document.title="SQLPad - Not Found"},[]),r.a.createElement(W,null,"Not Found")};var G=function({passwordResetId:e}){const t=Object(a.useState)(""),n=Object(s.a)(t,2),l=n[0],c=n[1],i=Object(a.useState)(""),o=Object(s.a)(i,2),u=o[0],d=o[1],m=Object(a.useState)(""),p=Object(s.a)(m,2),f=p[0],b=p[1],E=Object(a.useState)(!1),g=Object(s.a)(E,2),x=g[0],C=g[1],k=function(){var t=Object(w.a)(v.a.mark((function t(n){var a,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),a={email:l,password:u,passwordConfirmation:f},t.next=4,P.post("/api/password-reset/".concat(e),a);case 4:if(!(r=t.sent).error){t.next=7;break}return t.abrupt("return",h(r.error));case 7:C(!0);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(a.useEffect)(()=>{document.title="SQLPad - Password Reset"},[]),x?r.a.createElement(y.a,{to:"/"}):r.a.createElement("div",{style:{width:"300px",textAlign:"center",margin:"100px auto"}},r.a.createElement("form",{onSubmit:k},r.a.createElement("h1",null,"SQLPad"),r.a.createElement(A,{name:"email",type:"email",placeholder:"Email address",onChange:e=>c(e.target.value),required:!0}),r.a.createElement(B,null),r.a.createElement(A,{name:"password",type:"password",placeholder:"Password",onChange:e=>d(e.target.value),required:!0}),r.a.createElement(B,null),r.a.createElement(A,{name:"passwordConfirmation",type:"password",placeholder:"Confirm Password",onChange:e=>b(e.target.value),required:!0}),r.a.createElement(B,{size:2}),r.a.createElement(R,{style:{width:"100%"},htmlType:"submit",variant:"primary"},"Reset Password")))},V=e=>(document.title="SQLPad - Password Reset",r.a.createElement(W,null,r.a.createElement("p",null,"Password reset requested."),r.a.createElement("p",null,"An email has been sent with further instruction."))),Y=n(27),X=n(43),K=n.n(X),J=n(46),Z=n.n(J);var $=e=>{let t=e.children,n=e.icon,a=e.tooltip,l=e.variant,c=Object(I.a)(e,["children","icon","tooltip","variant"]);const i="ghost"===l?"".concat(Z.a.btn," ").concat(Z.a.ghost):Z.a.btn,o=r.a.createElement(Y.a,null,r.a.createElement(Y.b,Object.assign({className:i},c),n&&r.a.cloneElement(n,{size:18},null)),r.a.createElement(Y.e,{className:"slide-down"},t));return a?r.a.createElement(N,{label:a},r.a.createElement("span",null,o)):o};const ee=r.a.forwardRef((e,t)=>r.a.createElement(E.b,Object.assign({},e,{innerRef:t})));var te=function({links:e,onSaveImageClick:t}){const n=j().config;if(!n||!e)return null;const a=n.allowCsvDownload,l=[];return t&&l.push(r.a.createElement(Y.c,{key:"png",onSelect:t},"png")),a&&(l.push(r.a.createElement(Y.d,{key:"csv",as:ee,to:e.csv,target:"_blank",rel:"noopener noreferrer"},"csv")),l.push(r.a.createElement(Y.d,{key:"xlsx",as:ee,to:e.xlsx,target:"_blank",rel:"noopener noreferrer"},"xlsx")),l.push(r.a.createElement(Y.d,{key:"json",as:ee,to:e.json,target:"_blank",rel:"noopener noreferrer"},"json"))),0===l.length?null:r.a.createElement($,{icon:r.a.createElement(K.a,{"aria-label":"Download"})},l)},ne=n(149),ae=n.n(ne),re=n(113),le=n.n(re);var ce=e=>{let t=e.children,n=e.className,a=e.type,l=Object(I.a)(e,["children","className","type"]);const c=[];return n&&c.push(n),"secondary"===a?c.push(le.a.secondary):"danger"===a&&c.push(le.a.danger),r.a.createElement("span",Object.assign({className:c.join(" ")},l),t)},ie=n(114),oe=n.n(ie);var se=function({tooltip:e,children:t}){return r.a.createElement(N,{label:e},r.a.createElement("span",null,r.a.createElement(ce,{className:oe.a.text,type:"danger"},r.a.createElement(ae.a,{size:18,className:oe.a.AlertIcon}),t)))};var ue=function(){return r.a.createElement(se,{tooltip:"Return fewer rows or increase query result max rows in configuration."},"Incomplete")};n(227);function de(){return r.a.createElement("div",{className:"sk-cube-grid"},r.a.createElement("div",{className:"sk-cube sk-cube1"}),r.a.createElement("div",{className:"sk-cube sk-cube2"}),r.a.createElement("div",{className:"sk-cube sk-cube3"}),r.a.createElement("div",{className:"sk-cube sk-cube4"}),r.a.createElement("div",{className:"sk-cube sk-cube5"}),r.a.createElement("div",{className:"sk-cube sk-cube6"}),r.a.createElement("div",{className:"sk-cube sk-cube7"}),r.a.createElement("div",{className:"sk-cube sk-cube8"}),r.a.createElement("div",{className:"sk-cube sk-cube9"}))}var me=function(){return r.a.createElement("div",{className:"h-100 flex-center"},r.a.createElement(de,null))},pe=n(51);var fe=function({children:e}){return r.a.createElement("div",{className:"sp-error-block"},e)};var he=[{chartType:"line",tauChartsType:"line",chartLabel:"Line",fields:[{fieldId:"x",required:!0,label:"x",inputType:"field-dropdown"},{fieldId:"y",required:!0,label:"y",inputType:"field-dropdown"},{fieldId:"split",required:!1,label:"color / line for each",inputType:"field-dropdown",forceDimension:!0},{fieldId:"size",required:!1,label:"size",inputType:"field-dropdown"},{fieldId:"xFacet",requied:!1,label:"x Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"yFacet",required:!1,label:"y Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"filter",required:!1,label:"Quick Filter",inputType:"checkbox"},{fieldId:"trendline",required:!1,label:"Show Trendline",inputType:"checkbox"},{fieldId:"yMin",required:!1,label:"y Axis Min",inputType:"textbox"},{fieldId:"yMax",required:!1,label:"y Axis Max",inputType:"textbox"}]},{chartType:"bar",tauChartsType:"horizontalBar",chartLabel:"Bar - Horizontal",fields:[{fieldId:"barlabel",required:!0,label:"Bar Label",inputType:"field-dropdown"},{fieldId:"barvalue",required:!0,label:"Bar Value",inputType:"field-dropdown"},{fieldId:"labelFacet",required:!1,label:"Bar Label Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"valueFacet",required:!1,label:"Bar Value Facet",inputType:"field-dropdown",forceDimension:!0}]},{chartType:"verticalbar",tauChartsType:"bar",chartLabel:"Bar - Vertical",fields:[{fieldId:"barlabel",required:!0,label:"Bar Label",inputType:"field-dropdown"},{fieldId:"barvalue",required:!0,label:"Bar Value",inputType:"field-dropdown"},{fieldId:"labelFacet",required:!1,label:"Bar Label Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"valueFacet",required:!1,label:"Bar Value Facet",inputType:"field-dropdown",forceDimension:!0}]},{chartType:"bubble",tauChartsType:"scatterplot",chartLabel:"Scatterplot",fields:[{fieldId:"x",label:"x Axis",inputType:"field-dropdown",required:!0},{fieldId:"y",label:"y Axis",inputType:"field-dropdown",required:!0},{fieldId:"size",label:"Size",inputType:"field-dropdown",required:!1},{fieldId:"color",label:"Color",inputType:"field-dropdown",required:!1},{fieldId:"xFacet",requied:!1,label:"x Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"yFacet",required:!1,label:"y Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"filter",required:!1,label:"Quick Filter",inputType:"checkbox"},{fieldId:"trendline",required:!1,label:"Show Trendline",inputType:"checkbox"}]},{chartType:"stacked-bar-vertical",tauChartsType:"stacked-bar",chartLabel:"Stacked Bar - Vertical",fields:[{fieldId:"barlabel",required:!0,label:"Bar Label",inputType:"field-dropdown"},{fieldId:"barvalue",required:!0,label:"Bar Value",inputType:"field-dropdown"},{fieldId:"color",label:"Color",inputType:"field-dropdown",required:!1},{fieldId:"labelFacet",required:!1,label:"Bar Label Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"valueFacet",required:!1,label:"Bar Value Facet",inputType:"field-dropdown",forceDimension:!0}]},{chartType:"stacked-bar-horizontal",tauChartsType:"horizontal-stacked-bar",chartLabel:"Stacked Bar - Horizontal",fields:[{fieldId:"barlabel",required:!0,label:"Bar Label",inputType:"field-dropdown"},{fieldId:"barvalue",required:!0,label:"Bar Value",inputType:"field-dropdown"},{fieldId:"color",label:"Color",inputType:"field-dropdown",required:!1},{fieldId:"labelFacet",required:!1,label:"Bar Label Facet",inputType:"field-dropdown",forceDimension:!0},{fieldId:"valueFacet",required:!1,label:"Bar Value Facet",inputType:"field-dropdown",forceDimension:!0}]}],be=n(151),ye=n.n(be),Ee=n(152),ge=n.n(Ee),ve=n(115),we=n.n(ve),xe=n(153),Ce=n.n(xe),ke=n(116),Oe=n.n(ke);function je(e,t){if(!e)return null;const n=t?t.columns:[];let a=t?t.rows:[];const r=e.chartType,l=e.fields;if(!r||!l)return null;const c=he.find(e=>e.chartType===r);if(!a.length||!c)return null;const i={type:c.tauChartsType,plugins:[Ce()(),ge()(),ye()({cssPaths:[window.BASE_URL+"/javascripts/vendor/tauCharts/tauCharts.min.css"]})],settings:{asyncRendering:!0,renderingTimeout:1e4,syncRenderingInterval:50,handleRenderingErrors:!0,utcTime:!0}};a=a.map(e=>{const t={};return n.forEach(n=>{const a=n.datatype,r=n.name;t[r]="date"===a||"datetime"===a?new Date(e[r]):"number"===a?Number(e[r]):e[r]}),c.fields.filter(e=>!0===e.forceDimension).forEach(e=>{const a=l[e.fieldId],r=n.find(e=>e.name===a),c=r?r.datatype:null;a&&"number"===c&&t[a]&&(t[a]=t[a].toString())}),t});const o=Object.keys(e.fields).reduce((t,a)=>{const r=c.fields.find(e=>e.fieldId===a),l=e.fields[a];return(r&&"field-dropdown"!==r.inputType||n.find(e=>e.name===l))&&(t[a]=l),t},{});if(((e,t)=>{const n=he.find(t=>t.chartType===e);if(!n)throw new Error("Unknown chartType ".concat(e));const a=[];return n.fields.forEach(e=>{e.required&&!t[e.fieldId]&&a.push(e)}),a})(r,o).length)return null;const s=o.x,u=o.xFacet,d=o.y,m=o.yFacet,p=o.filter,f=o.trendline,h=o.split,b=o.size,y=o.yMin,E=o.yMax,g=o.barvalue,v=o.valueFacet,w=o.barlabel,x=o.labelFacet,C=o.color;switch(r){case"line":i.x=[s],u&&i.x.unshift(u),i.y=[d],m&&i.y.unshift(m),p&&i.plugins.push(we()()),f&&i.plugins.push(Oe()()),h&&(i.color=h),b&&(i.size=b),(y||E)&&(i.guide={y:{autoScale:!1}},y&&(i.guide.y.min=Number(y)),E&&(i.guide.y.max=Number(E)));break;case"bar":i.x=[g],v&&i.x.unshift(v),i.y=[w],x&&i.y.unshift(x);break;case"verticalbar":i.y=[g],v&&i.y.unshift(v),i.x=[w],x&&i.x.unshift(x);break;case"stacked-bar-horizontal":i.x=[g],v&&i.x.unshift(v),i.y=[w],x&&i.y.unshift(x),C&&(i.color=C);break;case"stacked-bar-vertical":i.y=[g],v&&i.y.unshift(v),i.x=[w],x&&i.x.unshift(x),C&&(i.color=C);break;case"bubble":i.x=[s],u&&i.x.unshift(u),i.y=[d],m&&i.y.unshift(m),p&&i.plugins.push(we()()),f&&i.plugins.push(Oe()()),b&&(i.size=b),C&&(i.color=C);break;default:console.error("unknown chart type")}return i.data=a,i}const Se={};function Ie(e,t){const n=Se[e];n&&n.fire&&n.fire("export-to",{type:"png",fileName:t})}var qe=function({isRunning:e,queryError:t,queryResult:n,chartConfiguration:l,queryId:c}){return Object(a.useEffect)(()=>{let a;if(!e&&!t&&l&&n){const e=je(l,n);e&&(a=new pe.Chart(e),a.renderTo("#chart"))}return function(e,t){Se[e]=t}(c,a),()=>{a&&a.destroy(),function(e){delete Se[e]}(c)}},[e,t,n,l,c]),e?r.a.createElement("div",{id:"chart",className:"flex-center h-100 w-100"},r.a.createElement(de,null)):t?r.a.createElement(fe,null,t):r.a.createElement("div",{id:"chart",className:"flex-center h-100 w-100"})},Te=n(9);function _e(e){return new Promise(t=>setTimeout(t,e))}function Ne(e){return Re.apply(this,arguments)}function Re(){return(Re=Object(w.a)(v.a.mark((function e(t){var n,a,r,l,c,i,o,s,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.connectionId){e.next=2;break}return e.abrupt("return",{error:"Connection required"});case 2:if(t.batchText){e.next=4;break}return e.abrupt("return",{error:"SQL text required"});case 4:return t.selectedText||(t.selectedText=t.batchText),e.next=7,P.post("/api/batches",t);case 7:if(r=e.sent,a=r.error,n=r.data,!a){e.next=12;break}return e.abrupt("return",{error:a});case 12:if("finished"===n.status||"error"===n.status||a){e.next=22;break}return e.next=15,_e(500);case 15:return e.next=17,P.get("/api/batches/".concat(n.id));case 17:r=e.sent,a=r.error,n=r.data,e.next=12;break;case 22:if(!a){e.next=24;break}return e.abrupt("return",{error:a});case 24:if(n.statements.length){e.next=26;break}return e.abrupt("return",{error:"Statements not found"});case 26:if(!(l=n.statements.find(e=>e.error))){e.next=29;break}return e.abrupt("return",{error:l.error.title});case 29:return c=n.statements[n.statements.length-1],e.next=32,P.get("/api/statements/".concat(c.id,"/results"));case 32:if((r=e.sent).error&&(a=r.error),!a){e.next=36;break}return e.abrupt("return",{error:a});case 36:return i=c.columns,o=r.data.map(e=>{const t={};return i.forEach((n,a)=>{t[n.name]=e[a]}),t}),s={csv:"/statement-results/".concat(c.id,".csv"),json:"/statement-results/".concat(c.id,".json"),xlsx:"/statement-results/".concat(c.id,".xlsx")},t.queryId&&(s.table="/query-table/".concat(t.queryId),s.chart="/query-chart/".concat(t.queryId),t.connectionClientId&&(u="?connectionClientId=".concat(t.connectionClientId),s.table+=u,s.chart+=u)),e.abrupt("return",{data:Object(Te.a)({},n,{batchId:n.id,statementId:c.id,columns:i,rows:o,incomplete:c.incomplete,links:s,startTime:c.startTime,stopTime:c.stopTime,durationMs:c.durationMs}),error:a});case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Le=function(e){const t=Object(a.useState)(!1),n=Object(s.a)(t,2),r=n[0],l=n[1],c=Object(a.useState)(null),i=Object(s.a)(c,2),o=i[0],u=i[1],d=Object(a.useState)(null),m=Object(s.a)(d,2),p=m[0],f=m[1];return Object(a.useEffect)(()=>{(function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,P.get("/api/queries/".concat(t));case 3:if(!(n=e.sent).error){e.next=8;break}return l(!1),f(n.error),e.abrupt("return");case 8:return a=n.data,e.next=11,Ne({queryId:t,name:a.name,chart:a.chart,batchText:a.queryText,connectionId:a.connectionId});case 11:r=e.sent,l(!1),f(r.error),u(Object(Te.a)({},a,{},r.data));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}})()(e)},[e]),[p,o,r]};var De=function({queryId:e}){const t=Le(e),n=Object(s.a)(t,3),l=n[0],c=n[1],i=n[2];if(Object(a.useEffect)(()=>{document.title="SQLPad"},[]),i||!c)return r.a.createElement("div",{style:{display:"flex",height:"100vh",width:"100%",flexDirection:"column"}},r.a.createElement(me,null));const o=c.name,u=c.chart,d=c.links,m=c.incomplete;return r.a.createElement("div",{style:{display:"flex",height:"100vh",width:"100%",flexDirection:"column",padding:"16px"}},r.a.createElement("div",{style:{height:"50px"}},r.a.createElement("span",{style:{fontSize:"1.5rem"}},o||""),r.a.createElement("div",{style:{float:"right"}},m&&r.a.createElement(ue,null),r.a.createElement(te,{links:d,onSaveImageClick:()=>{Ie(e,o||"")}}))),r.a.createElement("div",{style:{height:"100%",display:"flex"}},r.a.createElement(qe,{queryId:e,queryName:o,chartConfiguration:u,queryResult:c,queryError:l,isRunning:i})))},Ae=n(107),Be=n.n(Ae),Qe=n(96),ze=n(63),Fe=n(62),Ue=n.n(Fe),Pe=n(92),Me=n.n(Pe);var We=r.a.forwardRef((e,t)=>{let n=e.children,a=e.variant,l=e.to,c=(e.icon,e.tooltip),i=e.disabled,o=e.className,s=Object(I.a)(e,["children","variant","to","icon","tooltip","disabled","className"]);const u=[Z.a.btn];let d;return o&&u.push(o),"danger"===a?u.push(Z.a.danger):"ghost"===a&&u.push(Z.a.ghost),d=l&&!i?r.a.createElement("div",{style:{display:"inline",lineHeight:"initial"}},r.a.createElement(E.b,Object.assign({to:l,className:u.join(" ")},s),r.a.Children.map(n,e=>r.a.cloneElement(e,{size:18},null)))):r.a.createElement("button",Object.assign({ref:t,className:u.join(" "),disabled:i},s),r.a.Children.map(n,e=>r.a.cloneElement(e,{size:18},null))),!c||i?d:r.a.createElement(N,{label:c},d)});var He=function({title:e,visible:t,onClose:n,width:a,placement:l,children:c}){const i={width:a};return"right"===l&&(i.right=0),t?r.a.createElement(ze.a,{"aria-label":e,onDismiss:n,className:Me.a.Dialog,style:i},r.a.createElement("div",{className:Me.a.titleWrapper},e,r.a.createElement(We,{onClick:n},r.a.createElement(Ue.a,null))),r.a.createElement("div",{className:Me.a.dialogBody},c)):null},Ge=n(154),Ve=n.n(Ge),Ye=n(155),Xe=n.n(Ye),Ke=n(67),Je=n.n(Ke);var Ze=r.a.forwardRef((e,t)=>{let n=e.children,l=e.confirmMessage,c=e.onConfirm,i=(e.className,e.icon),o=Object(I.a)(e,["children","confirmMessage","onConfirm","className","icon"]);const u=Object(a.useState)(!1),d=Object(s.a)(u,2),m=d[0],p=d[1],f=Object(a.useRef)(null);return r.a.createElement(r.a.Fragment,null,i?r.a.createElement(We,Object.assign({onClick:()=>p(!0),ref:t,variant:"danger"},o),r.a.createElement(Xe.a,null)):r.a.createElement(R,Object.assign({onClick:()=>p(!0),ref:t,variant:"danger"},o),n),m&&r.a.createElement(ze.a,{"aria-label":l,onDismiss:()=>p(!1),className:Je.a.Dialog,initialFocusRef:f},r.a.createElement("div",{className:Je.a.dialogContent},r.a.createElement("span",null,l)),r.a.createElement("div",{className:Je.a.buttonWrapper},r.a.createElement(R,{variant:"danger",className:Je.a.button,onClick:()=>{p(!1),c()}},"Delete"),r.a.createElement(R,{ref:f,className:Je.a.button,onClick:()=>p(!1)},"Cancel"))))}),$e=n(156),et=n.n($e);var tt=e=>{let t=e.children,n=e.className,a=Object(I.a)(e,["children","className"]);const l=[et.a.ListItem];return n&&l.push(n),r.a.createElement("div",Object.assign({className:l.join(" ")},a),t)};function nt({leftWidth:e="35%",rightWidth:t="65%",label:n,children:a}){return r.a.createElement("div",{style:{marginTop:24,display:"flex",alignItems:"flex-start"}},r.a.createElement("div",{style:{flexBasis:e,marginRight:16,marginTop:4,textAlign:"left"}},r.a.createElement("label",{htmlFor:n},n)),r.a.createElement("div",{style:{flexBasis:t}},a))}var at=n(117),rt=n.n(at);function lt(e){let t=e.children,n=e.error,a=e.className,l=Object(I.a)(e,["children","error","className"]);const c=[rt.a.select];return a&&c.push(a),n&&c.push(rt.a.danger),r.a.createElement("select",Object.assign({className:c.join(" ")},l),t)}var ct=function({onConnectionAccessSaved:e}){const t=Object(a.useState)({}),n=Object(s.a)(t,2),l=n[0],c=n[1],o=Object(a.useState)(!1),u=Object(s.a)(o,2),d=u[0],m=u[1];let p=Object(i.b)("/api/connections").data;const f=[{id:"__EVERY_CONNECTION__",name:"Every Connection"}].concat(p||[]);let b=Object(i.b)("/api/users").data;const y=[{id:"__EVERYONE__",email:"Everyone"}].concat(b||[]),E=(e,t)=>{c(n=>Object(Te.a)({},n,{[e]:t}))},g=function(){var t=Object(w.a)(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!d){t.next=2;break}return t.abrupt("return");case 2:return m(!0),t.next=5,P.post("/api/connection-accesses",l);case 5:if(!(n=t.sent).error){t.next=9;break}return m(!1),t.abrupt("return",h(n.error));case 9:return t.abrupt("return",e(n.data));case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),x=l.connectionId,C=void 0===x?"":x,k=l.userId,O=void 0===k?"":k,j=l.duration,S=void 0===j?"":j,I=[r.a.createElement("option",{key:"none",value:""})];f.length?f.sort((e,t)=>e.name>t.name).forEach(e=>I.push(r.a.createElement("option",{key:e.id,value:e.id},e.name))):I.push(r.a.createElement("option",{key:"loading",value:""},"Loading..."));const q=[r.a.createElement("option",{key:"none",value:""})];return y.length?y.sort((e,t)=>e.name>t.name).forEach(e=>q.push(r.a.createElement("option",{key:e.id,value:e.id},e.email))):q.push(r.a.createElement("option",{key:"loading",value:""},"Loading...")),r.a.createElement("div",{style:{height:"100%"}},r.a.createElement("form",{onSubmit:g,autoComplete:"off",style:{display:"flex",flexDirection:"column",height:"100%"}},r.a.createElement(nt,{label:"Connection"},r.a.createElement(lt,{name:"connectionId",value:C,error:!C,onChange:e=>E("connectionId",e.target.value)},I)),r.a.createElement(nt,{label:"User"},r.a.createElement(lt,{name:"userId",value:O,error:!O,onChange:e=>E("userId",e.target.value)},q)),r.a.createElement(nt,{label:"Duration in seconds (optional)"},r.a.createElement(A,{name:"duration",value:S,onChange:e=>E(e.target.name,e.target.value)})),r.a.createElement("br",null),r.a.createElement("div",{style:{borderTop:"1px solid #e8e8e8",paddingTop:"22px",textAlign:"right"}},r.a.createElement(R,{htmlType:"submit",style:{width:120},variant:"primary",onClick:g,disabled:d},d?"Creating...":"Create")," ")))};var it=function({connectionId:e,visible:t,onClose:n,onConnectionAccessSaved:a,placement:l}){return r.a.createElement(He,{title:"Create Access",visible:t,width:520,onClose:n,placement:l||"right"},r.a.createElement(ct,{connectionId:e,onConnectionAccessSaved:a}))};var ot=function(){const e=j().currentUser,t=Object(a.useState)(!1),n=Object(s.a)(t,2),l=n[0],c=n[1],o=Object(a.useState)(!1),u=Object(s.a)(o,2),d=u[0],m=u[1];let p="/api/connection-accesses";l&&(p+="?includeInactives=true");let f=Object(i.b)(p),b=f.data,y=f.mutate;const E=b||[],g=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.put("/api/connection-accesses/".concat(t,"/expire"));case 2:if(n=e.sent,a=l?E.map(e=>e.id===t?n.data:e):E.filter(e=>e.id!==t),y(a),!n.error){e.next=7;break}return e.abrupt("return",h("Expire Failed: "+n.error.toString()));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(R,{style:{marginRight:8},onClick:()=>{c(!l)}},l?"Hide Expired":"Show Expired"),r.a.createElement(R,{style:{width:135},variant:"primary",onClick:()=>{m(!0)}},"Create Access")),E.map(t=>{const n=[],a=new Date(t.expiryDate)-new Date,l=a<0;return"admin"!==e.role||l||n.push(r.a.createElement(Ze,{key:"expire",confirmMessage:"Expire connection access?",onConfirm:e=>g(t.id),style:{marginLeft:8}},"Expire")),r.a.createElement(tt,{key:t.id},r.a.createElement("div",{style:{flexGrow:1,padding:8}},r.a.createElement("b",null,"Connection:")," ",t.connectionName,r.a.createElement("br",null),r.a.createElement("b",null,"User:")," ",t.userEmail,r.a.createElement("br",null),r.a.createElement(ce,{type:"secondary"},"Duration: ",t.duration||"Indefinite"," ",!t.duration||"seconds","\xa0\xa0 - \xa0\xa0 Expiry Date:"," ",new Date(t.expiryDate).toLocaleString()),r.a.createElement("br",null),l?r.a.createElement(ce,{type:"danger"},"Expired"):r.a.createElement(ce,{type:"secondary"},"Time to Expire:"," ",Ve()(a,{units:["d","h","m"],round:!0}))),n)}),r.a.createElement(it,{visible:d,onClose:()=>{m(!1)},onConnectionAccessSaved:e=>{const t=[e].concat(E);y(t),m(!1)},placement:"left"}))};var st=function({visible:e,onClose:t}){return r.a.createElement(He,{title:"Connection Accesses",visible:e,width:600,onClose:t,placement:"left"},r.a.createElement(ot,{onClose:t}))};const ut=e=>function(){var t=Object(w.a)(v.a.mark((function t(n){var a,r,l,c,i,o,s;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.connectionClient,r=n.selectedConnectionId,!a&&r){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,P.get("/api/connections");case 5:if(l=t.sent,c=l.data,i=(c||[]).find(e=>e.id===r),i&&i.supportsConnectionClient&&i.multiStatementTransactionEnabled){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,P.post("/api/connection-clients",{connectionId:r});case 13:if(!(o=t.sent).error){t.next=16;break}return t.abrupt("return",h("Problem connecting to database"));case 16:return s=setInterval(Object(w.a)(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,P.put("/api/connection-clients/".concat(o.data.id));case 2:(n=t.sent).error&&h(n.error),!n.data&&s?(clearInterval(s),e.setState({connectionClientInterval:null,connectionClient:null})):e.setState({connectionClient:n.data});case 5:case"end":return t.stop()}}),t)}))),1e4),t.abrupt("return",{connectionClient:o.data,connectionClientInterval:s});case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),dt=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.connectionClient,(a=t.connectionClientInterval)&&clearInterval(a),n&&P.delete("/api/connection-clients/".concat(n.id)).then(e=>{e.error&&h(e.error)}),e.abrupt("return",{connectionClient:null,connectionClientInterval:null});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mt=(e,t)=>{const n=e.connectionClient,a=e.connectionClientInterval;return C.a.setItem("selectedConnectionId",t).catch(e=>h(e)),n&&P.delete("/api/connection-clients/".concat(n.id)).then(e=>{e.error&&h(e.error)}),a&&clearInterval(a),{selectedConnectionId:t,connectionClient:null,connectionClientInterval:null}};var pt={selectedConnectionId:"",connectionClient:null,connectionClientInterval:null},ft=n(157),ht=n.n(ft),bt=n(158),yt=n.n(bt),Et=n(159),gt=n.n(Et);function vt({children:e}){return r.a.createElement("span",{className:gt.a.formExplain},e)}var wt=n(118),xt=n.n(wt);function Ct(e){let t=e.children,n=e.error,a=e.className,l=Object(I.a)(e,["children","error","className"]);const c=[xt.a.textarea];return n&&c.push(xt.a.danger),a&&c.push(a),r.a.createElement("textarea",Object.assign({className:c.join(" ")},l),t)}var kt=function({connectionId:e,onConnectionSaved:t}){const n=Object(a.useState)({}),l=Object(s.a)(n,2),c=l[0],o=l[1],u=Object(a.useState)(!1),d=Object(s.a)(u,2),m=d[0],p=d[1],f=Object(a.useState)(!1),b=Object(s.a)(f,2),y=b[0],E=b[1],g=Object(a.useState)(!1),x=Object(s.a)(g,2),C=x[0],k=x[1],O=Object(a.useState)(null),j=Object(s.a)(O,2),S=j[0],I=j[1],q=Object(a.useState)(!1),T=Object(s.a)(q,2),_=T[0],N=T[1];let L=Object(i.b)("/api/drivers").data;function D(){return(D=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=7;break}return N(!0),e.next=4,P.get("/api/connections/".concat(t));case 4:n=e.sent,N(!1),n.error?h(n.error):((a=n.data&&parseInt(n.data.idleTimeoutSeconds,10))&&(n.data.idleTimeoutMinutes=Math.round(a/60)),o(n.data));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}L=L||[],Object(a.useEffect)(()=>{!function(e){D.apply(this,arguments)}(e)},[e]);const B=(e,t)=>{o(n=>Object(Te.a)({},n,{[e]:t}))},Q=(e,t)=>{o(n=>{const a=n.data||{};return Object(Te.a)({},n,{data:Object(Te.a)({},a,{[e]:t})})})},z=function(){var e=Object(w.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(!0),t=c.data||{},e.next=4,P.post("/api/test-connection",Object(Te.a)({},c,{},t));case 4:n=e.sent,E(!1),k(!0),I(n.error);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(w.a)(v.a.mark((function e(n){var a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),n.stopPropagation(),!m){e.next=4;break}return e.abrupt("return");case 4:if(p(!0),(a=parseInt(c.idleTimeoutMinutes,10))&&(c.idleTimeoutSeconds=60*a),!c.id){e.next=13;break}return e.next=10,P.put("/api/connections/".concat(c.id),c);case 10:r=e.sent,e.next=16;break;case 13:return e.next=15,P.post("/api/connections",c);case 15:r=e.sent;case 16:if(!r.error){e.next=19;break}return p(!1),e.abrupt("return",h(r.error));case 19:return Object(i.c)("/api/connections"),e.abrupt("return",t(r.data));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=c.name,M=void 0===U?"":U,W=c.driver,H=void 0===W?"":W,G=[r.a.createElement("option",{key:"none",value:""})];return L.length?L.sort((e,t)=>e.name>t.name).forEach(e=>G.push(r.a.createElement("option",{key:e.id,value:e.id},e.name))):G.push(r.a.createElement("option",{key:"loading",value:""},"Loading...")),_?r.a.createElement("div",{className:"h-100 w-100 flex-center"},r.a.createElement(de,null)):r.a.createElement("form",{onSubmit:F,autoComplete:"off",style:{display:"flex",flexDirection:"column",height:"100%"}},r.a.createElement("div",{style:{overflowY:"auto",flexGrow:1}},r.a.createElement(nt,{label:"Connection name"},r.a.createElement(A,{name:"name",value:M,error:!M,onChange:e=>B(e.target.name,e.target.value)})),r.a.createElement(nt,{label:"Driver"},r.a.createElement(lt,{name:"driver",value:H,error:!H,onChange:e=>B("driver",e.target.value)},G)),(()=>{if(c.driver&&L.length){const e=L.find(e=>e.id===c.driver);if(!e)return console.error("Driver ".concat(c.driver," not found")),null;const t=[];if(e.supportsConnectionClient){const e="multiStatementTransactionEnabled";t.push(r.a.createElement(nt,{key:e},r.a.createElement("input",{type:"checkbox",checked:c.multiStatementTransactionEnabled||!1,id:e,name:e,onChange:e=>B(e.target.name,e.target.checked)}),r.a.createElement("label",{htmlFor:e,style:{marginLeft:8}},"Enable multi-statement transaction support"),r.a.createElement(vt,null,"When enabled a persistent database connection will be opened and used for query executions, allowing things like opening transactions and creating temp tables across query executions."))),t.push(r.a.createElement(nt,{key:"idleTimeoutMinutes",label:"Idle timeout (minutes)"},r.a.createElement(A,{name:"idleTimeoutMinutes",type:"number",value:c.idleTimeoutMinutes||"",onChange:e=>B(e.target.name,e.target.value)}),r.a.createElement(vt,null,"Number of minutes to allow a connection to be idle before closing.")))}const n=e.fields,a=c.data||{},l=n.map(e=>{if("TEXT"===e.formType){const t=a[e.key]||"";return r.a.createElement(nt,{key:e.key,label:e.label},r.a.createElement(A,{name:e.key,value:t,onChange:e=>Q(e.target.name,e.target.value)}),e.description&&r.a.createElement(vt,null,r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.description}})))}if("PASSWORD"===e.formType){const t=a[e.key]||"";return r.a.createElement(nt,{key:e.key,label:e.label},r.a.createElement(A,{type:"password",autoComplete:"new-password",name:e.key,value:t,onChange:e=>Q(e.target.name,e.target.value)}),e.description&&r.a.createElement(vt,null,r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.description}})))}if("CHECKBOX"===e.formType){const t=a[e.key]||!1;return r.a.createElement(nt,{key:e.key},r.a.createElement("input",{type:"checkbox",checked:t,id:e.key,name:e.key,onChange:e=>Q(e.target.name,e.target.checked)}),r.a.createElement("label",{htmlFor:e.key,style:{marginLeft:8}},e.label),e.description&&r.a.createElement(vt,null,r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.description}})))}if("TEXTAREA"===e.formType){const t=a[e.key]||"";return r.a.createElement(nt,{key:e.key,label:e.label},r.a.createElement(Ct,{name:e.key,value:t,cols:45,placeholder:e.placeholder,onChange:e=>Q(e.target.name,e.target.value)}),e.description&&r.a.createElement(vt,null,r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.description}})))}return null});return t.concat(l)}})()),!y&&S&&r.a.createElement("div",null,r.a.createElement(fe,null,S)),r.a.createElement("div",{style:{borderTop:"1px solid #e8e8e8",paddingTop:"22px",textAlign:"right"}},r.a.createElement(R,{htmlType:"submit",style:{width:120},variant:"primary",onClick:F,disabled:m},m?"Saving...":"Save")," ",r.a.createElement(R,{style:{width:120},onClick:z,disabled:y},y?"Testing...":"Test",!y&&C&&!S&&r.a.createElement(ht.a,{style:{marginLeft:8,height:18,width:18,marginBottom:-4},color:"#52c41a"}),!y&&C&&S&&r.a.createElement(yt.a,{style:{marginLeft:8,height:18,width:18,marginBottom:-4},color:"#eb2f96"}))))};var Ot=function({connectionId:e,visible:t,onClose:n,onConnectionSaved:a,placement:l}){const c=e?"Edit connection":"New connection";return r.a.createElement(He,{title:c,visible:t,width:560,onClose:n,placement:l||"right"},r.a.createElement(kt,{connectionId:e,onConnectionSaved:a}))};var jt=Object(o.connect)([],e=>({selectConnectionId:mt}))((function({selectConnectionId:e}){const t=Object(i.b)("/api/connections"),n=t.data,l=t.mutate;let c=n||[];const o=function(){var e=Object(w.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.delete("/api/connections/".concat(t));case 2:if(n=e.sent,l(),!n.error){e.next=6;break}return e.abrupt("return",h("Delete failed"));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=j().currentUser,d=Object(a.useState)(null),m=Object(s.a)(d,2),p=m[0],f=m[1],b=Object(a.useState)(!1),y=Object(s.a)(b,2),E=y[0],g=y[1],x=c.map(e=>{const t=[];return"admin"===u.role&&e.editable&&(t.push(r.a.createElement(R,{key:"edit",style:{marginLeft:8},onClick:()=>(f(e.id),void g(!0))},"edit")),t.push(r.a.createElement(Ze,{key:"delete",confirmMessage:"Delete connection?",onConfirm:t=>o(e.id),style:{marginLeft:8}},"Delete"))),r.a.createElement(tt,{key:e.id},r.a.createElement("div",{style:{flexGrow:1,padding:8}},r.a.createElement("span",{style:{width:300,display:"inline-block",marginRight:8}},e.name),r.a.createElement(ce,{type:"secondary"},e.driver)),t)});return r.a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(R,{style:{width:135},variant:"primary",onClick:()=>{f(null),g(!0)}},"Add connection")),r.a.createElement("div",{style:{flexGrow:1}},x),r.a.createElement(Ot,{connectionId:p,visible:E,onClose:()=>{f(null),g(!1)},onConnectionSaved:t=>{f(null),g(!1),p||e(t.id)},placement:"left"}))}));var St=function({visible:e,onClose:t}){return r.a.createElement(He,{title:"Connections",visible:e,width:600,onClose:t,placement:"left"},r.a.createElement(jt,{onClose:t}))},It=n(93),qt=n.n(It);var Tt=function({title:e,visible:t,onClose:n,width:a,children:l}){return t?r.a.createElement(ze.a,{"aria-label":e,onDismiss:n,className:qt.a.Dialog,style:{width:a}},r.a.createElement("div",{className:qt.a.titleWrapper},r.a.createElement("span",null,e),n&&r.a.createElement(We,{onClick:n},r.a.createElement(Ue.a,null))),r.a.createElement("div",{className:qt.a.dialogBody},l)):null},_t=n(160),Nt=n.n(_t);var Rt=e=>{let t=e.children,n=e.className,a=e.type,l=Object(I.a)(e,["children","className","type"]);const c=[];return n&&c.push(n),"danger"===a&&c.push(Nt.a.danger),r.a.createElement("pre",null,r.a.createElement("code",Object.assign({className:c.join(" ")},l),t))};var Lt=function({serviceToken:e}){return r.a.createElement("div",{style:{height:"100%"}},r.a.createElement(ce,{type:"danger"},"Make sure to copy your new service token now. You won\u2019t be able to see it again!"),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement("table",{style:{flexGrow:1,padding:8}},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Name:")),r.a.createElement("td",null,e.name)),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Role:")),r.a.createElement("td",null,e.role)),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Token:")),r.a.createElement("td",null,r.a.createElement(Rt,null,e.token))),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("b",null,"Exp:")),r.a.createElement("td",null,e.expiryDate?new Date(e.expiryDate).toLocaleString():"Indefinite")))),r.a.createElement("br",null),r.a.createElement("hr",null),r.a.createElement("br",null),r.a.createElement("p",null,r.a.createElement("b",null,"Example API call with JWT Service Token:")),r.a.createElement(Rt,null,"curl -X GET -H 'Accept: application/json' -H \"Authorization: Bearer\xa0",e.token,'" ',(()=>{const e=window.location;return e.protocol+"//"+e.host+window.BASE_URL})(),"/api/users"))};var Dt=function({onServiceTokenGenerated:e}){const t=Object(a.useState)({}),n=Object(s.a)(t,2),l=n[0],c=n[1],i=Object(a.useState)(!1),o=Object(s.a)(i,2),u=o[0],d=o[1],m=(e,t)=>{c(n=>Object(Te.a)({},n,{[e]:t}))},p=function(){var t=Object(w.a)(v.a.mark((function t(){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!u){t.next=2;break}return t.abrupt("return");case 2:return d(!0),t.next=5,P.post("/api/service-tokens",l);case 5:if(!(n=t.sent).error){t.next=9;break}return d(!1),t.abrupt("return",h(n.error));case 9:return t.abrupt("return",e(n.data));case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),f=l.name,b=void 0===f?"":f,y=l.role,g=void 0===y?"":y,x=l.duration,C=void 0===x?"":x;return r.a.createElement("div",{style:{height:"100%"}},r.a.createElement("p",null,"You can make authorized API calls to some endpoints using a signed"," ",r.a.createElement(E.b,{to:"jwt.io"},"JWT")," directly as a bearer token, rather than local user authentication, OAuth or SAML."),r.a.createElement("p",null,"When this is possible, you can avoid having to make a network request to external authorization server before making an API call or manage session cookies in your client. This makes accessing endpoints programmatically simple and secure."),r.a.createElement("form",{onSubmit:p,autoComplete:"off",style:{display:"flex",flexDirection:"column",height:"100%"}},r.a.createElement(nt,{label:"Service Name"},r.a.createElement(A,{name:"name",value:b||"",error:!b,onChange:e=>m(e.target.name,e.target.value)})),r.a.createElement(nt,{label:"Access Role"},r.a.createElement(lt,{name:"role",value:g,error:!g,onChange:e=>m(e.target.name,e.target.value)},r.a.createElement("option",{value:""}),r.a.createElement("option",{value:"editor"},"Editor"),r.a.createElement("option",{value:"admin"},"Admin"))),r.a.createElement(nt,{label:"Duration in hours (optional)"},r.a.createElement(A,{name:"duration",value:C,onChange:e=>m(e.target.name,e.target.value)})),r.a.createElement("br",null),r.a.createElement("div",{style:{borderTop:"1px solid #e8e8e8",paddingTop:"22px",textAlign:"right"}},r.a.createElement(R,{htmlType:"submit",style:{width:120},variant:"primary",onClick:p,disabled:u},u?"Generating...":"Generate")," ")))};var At=function(){const e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)(null),o=Object(s.a)(c,2),u=o[0],d=o[1],m=Object(a.useState)(!1),p=Object(s.a)(m,2),f=p[0],b=p[1],y=Object(i.b)("/api/service-tokens"),E=y.data,g=y.error,x=y.mutate,C=E||[];Object(a.useEffect)(()=>{g&&h(g)},[g]);const k=function(){var e=Object(w.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.delete("/api/service-tokens/".concat(t));case 2:if(!(n=e.sent).error){e.next=5;break}return e.abrupt("return",h("Delete failed: "+n.error));case 5:x(C.filter(e=>e.id!==t));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(R,{style:{width:135},variant:"primary",onClick:()=>{l(!0)}},"Generate")),C.map(e=>{const t=[];return t.push(r.a.createElement(Ze,{key:"delete",confirmMessage:"Delete service token?",onConfirm:t=>k(e.id),style:{marginLeft:8}},"Delete")),r.a.createElement(tt,{key:e.id},r.a.createElement("div",{style:{flexGrow:1,padding:8}},r.a.createElement("b",null,"Name:")," ",e.name,r.a.createElement("br",null),r.a.createElement("b",null,"Role:")," ",e.role,r.a.createElement("br",null),r.a.createElement("b",null,"Token:")," ",e.maskedToken,r.a.createElement("br",null),r.a.createElement("b",null,"Expiry Date:")," ",e.expiryDate?new Date(e.expiryDate).toLocaleString():"Indefinite",r.a.createElement("br",null)),t)}),r.a.createElement(Tt,{title:"Generate Service Token",visible:n,width:"500px",onClose:()=>{l(!1),b(!1)}},r.a.createElement(Dt,{onServiceTokenGenerated:e=>{x(),d(e),l(!1),b(!0)}})),r.a.createElement(Tt,{title:"Service Token generated",visible:f,width:"500px",onClose:()=>{d(null),b(!1)}},r.a.createElement(Lt,{serviceToken:u})))};var Bt=function({visible:e,onClose:t}){return r.a.createElement(He,{title:"Service Tokens",visible:e,width:600,onClose:t,placement:"left"},r.a.createElement(At,{onClose:t}))},Qt=n(260);var zt=function({userId:e}){let t=Object(i.b)("/api/users/".concat(e)).data;const n=t||{},l=Object(a.useState)(n.role),c=Object(s.a)(l,2),o=c[0],u=c[1],d=Object(a.useState)(n.passwordResetId),m=Object(s.a)(d,2),p=m[0],f=m[1];if(Object(a.useEffect)(()=>{u(n.role),f(n.passwordResetId)},[n.role,n.passwordResetId]),!t)return null;const b=function(){var e=Object(w.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(t.target.value),e.next=3,P.put("/api/users/".concat(n.id),{role:t.target.value});case 3:if(!(a=e.sent).error){e.next=6;break}return e.abrupt("return",h("Update failed: "+a.error));case 6:Object(i.c)("api/users"),Object(i.c)("/api/users/".concat(n.id));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(w.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(Qt.a)(),e.next=3,P.put("/api/users/"+n.id,{passwordResetId:t});case 3:if(!(a=e.sent).error){e.next=6;break}return e.abrupt("return",h("Update failed: "+a.error));case 6:f(t),Object(i.c)("api/users"),Object(i.c)("/api/users/".concat(n.id));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(w.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.put("/api/users/".concat(n.id),{passwordResetId:""});case 2:if(!(t=e.sent).error){e.next=5;break}return e.abrupt("return",h("Remove reset failed: "+t.error));case 5:f(null);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("label",null,"Role",r.a.createElement(lt,{name:"role",value:o,onChange:b},r.a.createElement("option",{value:"editor"},"Editor"),r.a.createElement("option",{value:"admin"},"Admin"))),r.a.createElement(vt,null,"Admins can manage database connections and users"),r.a.createElement(B,{size:3}),p?r.a.createElement("div",{style:{display:"flex",alignItems:"center"}},r.a.createElement("div",{style:{flexBasis:"50%"}},r.a.createElement(R,{className:"w-100",onClick:g},"Remove reset link")),r.a.createElement("div",{style:{flexBasis:"50%",textAlign:"center"}},r.a.createElement(E.b,{to:"/password-reset/".concat(p)},"Password reset link"))):r.a.createElement("div",null,r.a.createElement(R,{className:"w-100",onClick:y},"Generate password reset link")))};var Ft=function({onInvited:e}){const t=Object(a.useState)(null),n=Object(s.a)(t,2),l=n[0],c=n[1],i=Object(a.useState)(null),o=Object(s.a)(i,2),u=o[0],d=o[1],m=Object(a.useState)(null),p=Object(s.a)(m,2),f=p[0],b=p[1],y=function(){var t=Object(w.a)(v.a.mark((function t(n){var a,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),n.stopPropagation(),a={email:l,role:u},b(!0),t.next=6,P.post("/api/users",a);case 6:if(r=t.sent,b(!1),!r.error){t.next=11;break}return h("Add user failed: "+r.error),t.abrupt("return",!1);case 11:c(null),d(null),e();case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("p",null,"Users may only sign up if they have first been added. Once added, invite them to continue the sign-up process on the"," ",r.a.createElement(E.b,{to:"/signup"},"signup page"),"."),r.a.createElement("form",{onSubmit:y},r.a.createElement("label",null,"Email",r.a.createElement(A,{name:"email",type:"email",value:l||"",error:!l,onChange:e=>c(e.target.value)})),r.a.createElement(B,{size:2}),r.a.createElement("label",null,"role",r.a.createElement(lt,{name:"role",value:u||"",onChange:e=>d(e.target.value),error:!u},r.a.createElement("option",{value:""}),r.a.createElement("option",{value:"editor"},"Editor"),r.a.createElement("option",{value:"admin"},"Admin")),r.a.createElement(vt,null,"Admins can manage database connections and users")),r.a.createElement(B,{size:3}),r.a.createElement("div",null,r.a.createElement(R,{htmlType:"submit",className:"w-100",variant:"primary",onClick:y,disabled:f},"Add user"))))};var Ut=r.a.memo((function(){const e=j().currentUser,t=Object(a.useState)(!1),n=Object(s.a)(t,2),l=n[0],c=n[1],o=Object(a.useState)(null),u=Object(s.a)(o,2),d=u[0],m=u[1],p=Object(a.useState)(!1),f=Object(s.a)(p,2),b=f[0],y=f[1],E=Object(i.b)("/api/users"),g=E.data,x=E.error,C=E.mutate,k=(g||[]).map(e=>Object(Te.a)({},e,{key:e.id}));Object(a.useEffect)(()=>{x&&h(x)},[x]);const O=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),e.next=3,P.put("/api/users/".concat(t.id),{disabled:!t.disabled});case 3:if(n=e.sent,y(!1),!n.error){e.next=7;break}return e.abrupt("return",h("Disable toggle failed: "+n.error));case 7:a=k.map(e=>e.id===t.id?n.data:e),C(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(w.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.delete("/api/users/".concat(t.id));case 2:if(!(n=e.sent).error){e.next=5;break}return e.abrupt("return",h("Delete Failed: "+n.error));case 5:C(k.filter(e=>e.id!==t.id));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(R,{style:{width:135},variant:"primary",onClick:()=>c(!0)},"Add user")),k.map(t=>{const n=[];e&&e.id!==t.id&&(n.push(r.a.createElement(R,{key:"edit",style:{marginLeft:8},onClick:()=>m(t)},"Edit")),n.push(r.a.createElement(R,{key:"toggle-disable",style:{marginLeft:8},disabled:b,onClick:()=>O(t)},t.disabled?"Enable":"Disable")),n.push(r.a.createElement(Ze,{key:"delete",confirmMessage:"Delete ".concat(t.email,"?"),onConfirm:e=>S(t),style:{marginLeft:8}},"Delete")));let a="";return t.disabled?a=r.a.createElement("em",null," - disabled"):t.signupAt||(a=r.a.createElement("em",null," - not signed up yet")),r.a.createElement(tt,{key:t.id},r.a.createElement("div",{style:{flexGrow:1,padding:8}},t.email,r.a.createElement("br",null),r.a.createElement(ce,{type:"secondary"},t.role," ",a)),n)}),r.a.createElement(Tt,{title:"Add user",visible:l,width:"500px",onClose:()=>c(!1)},r.a.createElement(Ft,{onInvited:()=>{C(),c(!1)}})),r.a.createElement(Tt,{title:d&&d.email,visible:Boolean(d),width:"500px",onClose:()=>{C(),m(null)}},r.a.createElement(zt,{userId:d&&d.id})))}));var Pt=function(){return r.a.createElement("div",{style:{borderLeft:"1px solid rgba(255, 255, 255, 0.3)",marginTop:"4px",marginBottom:"4px",marginRight:4,marginLeft:4}})};var Mt=r.a.memo((function(){const e=j(),t=e.config,n=e.currentUser,l=Object(a.useState)(!1),c=Object(s.a)(l,2),i=c[0],o=c[1],u=Object(a.useState)(!1),d=Object(s.a)(u,2),m=d[0],p=d[1],f=Object(a.useState)(!1),h=Object(s.a)(f,2),b=h[0],y=h[1],E=Object(a.useState)(!1),g=Object(s.a)(E,2),v=g[0],w=g[1];if(!n||"admin"!==n.role)return null;let x=!1;"noauth"===n.id&&(x=!0);const C=t.showServiceTokensUI;return[r.a.createElement(Pt,{key:"divider"}),r.a.createElement(R,{key:"connection-button",variant:"ghost",onClick:()=>o(!0)},"Connections"),r.a.createElement(St,{key:"connection-drawer",visible:i,onClose:()=>o(!1)}),r.a.createElement(R,{key:"connection-access-button",variant:"ghost",onClick:()=>p(!0)},"Access"),r.a.createElement(st,{key:"connection-access-drawer",visible:m,onClose:()=>p(!1)}),r.a.createElement(R,{key:"user-button",variant:"ghost",onClick:()=>y(!0),hidden:x},"Users"),r.a.createElement(He,{key:"users-drawer",title:"Users",visible:b,width:600,onClose:()=>y(!1),placement:"left"},r.a.createElement(Ut,null)),r.a.createElement(R,{key:"service-tokens-button",variant:"ghost",onClick:()=>w(!0),hidden:!C},"Service Tokens"),r.a.createElement(Bt,{key:"service-tokens-drawer",visible:v,onClose:()=>w(!1)})]})),Wt=n(161),Ht=n.n(Wt),Gt=n(25),Vt=n.n(Gt);const Yt={display:"inline-flex",alignItems:"center"};function Xt({version:e}){return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement("strong",null,"Version"),": ",e),r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around",marginBottom:16}},r.a.createElement("a",{href:"http://rickbergfalk.github.io/sqlpad/",target:"_blank",rel:"noopener noreferrer",style:Yt},"Project page ",r.a.createElement(Vt.a,{size:18})),r.a.createElement("a",{href:"https://github.com/rickbergfalk/sqlpad/issues",target:"_blank",rel:"noopener noreferrer",style:Yt},"Submit an Issue ",r.a.createElement(Vt.a,{size:18})),r.a.createElement("a",{href:"https://github.com/rickbergfalk/sqlpad/blob/master/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer",style:Yt},"Changelog ",r.a.createElement(Vt.a,{size:18})),r.a.createElement("a",{href:"https://github.com/rickbergfalk/sqlpad",target:"_blank",rel:"noopener noreferrer",style:Yt},"GitHub ",r.a.createElement(Vt.a,{size:18}))),r.a.createElement("p",null,r.a.createElement("strong",null,"Shortcuts")),r.a.createElement("ul",{style:{paddingLeft:0}},r.a.createElement("li",{style:{listStyleType:"none",marginBottom:8}},r.a.createElement("code",null,"ctrl+s")," / ",r.a.createElement("code",null,"command+s")," : Save"),r.a.createElement("li",{style:{listStyleType:"none",marginBottom:8}},r.a.createElement("code",null,"ctrl+return")," / ",r.a.createElement("code",null,"command+return")," : Run"),r.a.createElement("li",{style:{listStyleType:"none",marginBottom:8}},r.a.createElement("code",null,"shift+return")," : Format")),r.a.createElement("p",null,r.a.createElement("strong",null,"Tip")),r.a.createElement("p",null,"Run only a portion of a query by highlighting it first."))}Xt.defaultProps={version:""};var Kt=Xt;var Jt=r.a.memo((function({visible:e,onClose:t}){const n=j().version;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Tt,{width:650,title:"About SQLPad",visible:e,onClose:t},r.a.createElement(Kt,{version:n})))}));var Zt=r.a.memo((function(){const e=j().currentUser,t=Object(a.useState)(!1),n=Object(s.a)(t,2),l=n[0],c=n[1],i=Object(a.useState)(!1),o=Object(s.a)(i,2),u=o[0],d=o[1];if(l)return r.a.createElement(y.a,{push:!0,to:"/signin"});let m=!1;return e&&"noauth"!==e.id||(m=!0),r.a.createElement("div",null,r.a.createElement($,{variant:"ghost",icon:r.a.createElement(Ht.a,{"aria-label":"menu"})},r.a.createElement(Y.c,{onSelect:()=>d(!0)},"About"),r.a.createElement(Y.c,{onSelect:Object(w.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.get("/api/signout");case 2:c(!0);case 3:case"end":return e.stop()}}),e)}))),hidden:m},"Sign out")),r.a.createElement(Jt,{visible:u,onClose:()=>d(!1)}))}));var $t=function({children:e}){return r.a.createElement("div",{className:"sp-info-block"},e)},en=n(54),tn=n(162),nn=n.n(tn),an=n(163),rn=n.n(an),ln=n(30);const cn={overflowX:"hidden",overflowY:"hidden"},on={lineHeight:"30px",backgroundColor:"#f4f4f4",justifyContent:"space-between",borderBottom:"1px solid #CCC",display:"flex",fontWeight:"bold",paddingLeft:".5rem",paddingRight:".5rem"},sn={lineHeight:"30px",paddingLeft:".5rem",paddingRight:".5rem",borderBottom:"1px solid #CCC",display:"relative"};class un extends r.a.PureComponent{constructor(...e){super(...e),this.state={dimensions:{width:-1,height:-1},columnWidths:{}},this.getColumnWidth=e=>{const t=this.state.columnWidths,n=this.props.queryResult,a=n.columns[e],r=this.state.dimensions.width;if(a)return t[a.name];const l=r-n.columns.map(e=>t[e.name]).reduce((e,t)=>e+t,0);return l<10?10:l},this.headerGrid=r.a.createRef(),this.bodyGrid=r.a.createRef(),this.resizeColumn=({dataKey:e,deltaX:t,columnIndex:n})=>{this.setState(n=>{const a=n.columnWidths,r=a[e]+t;return{columnWidths:Object(Te.a)({},a,{[e]:r>100?r:100})}},()=>{this.recalc(n)})},this.recalc=nn()(e=>{this.headerGrid.current.resetAfterColumnIndex&&(this.headerGrid.current.resetAfterColumnIndex(e),this.bodyGrid.current.resetAfterColumnIndex(e))},100),this.HeaderCell=({columnIndex:e,rowIndex:t,style:n})=>{const a=this.props.queryResult.columns[e];return a?r.a.createElement("div",{style:Object.assign({},n,on)},r.a.createElement("div",null,a.name),r.a.createElement(rn.a,{axis:"x",defaultClassName:"DragHandle",defaultClassNameDragging:"DragHandleActive",onDrag:(t,{deltaX:n})=>{this.resizeColumn({dataKey:a.name,deltaX:n,columnIndex:e})},position:{x:0},zIndex:999},r.a.createElement("span",{className:"DragHandleIcon"},"\u22ee"))):r.a.createElement("div",{style:Object.assign({},n,on)})},this.Cell=({columnIndex:e,rowIndex:t,style:n})=>{const a=this.props.queryResult,l=a.columns[e],c=Object.assign({},n,sn);if(t%2===0&&(c.backgroundColor="#fafafa"),l){const e=a.rows[t][l.name];return r.a.createElement("div",{style:c},r.a.createElement("div",{className:"truncate"},(o=l,null===(i=e)||void 0===i?r.a.createElement("em",null,"null"):!0===i||!1===i?i.toString():"datetime"===o.datatype?i.replace("T"," ").replace("Z",""):"date"===o.datatype?i.substring(0,10):"object"===typeof i?JSON.stringify(i,null,2):"string"===typeof i&&i.match("^https?://")?r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:i},i):i)))}var i,o;return r.a.createElement("div",{style:c},r.a.createElement("div",{className:"truncate"}))},this.handleGridScroll=({scrollLeft:e})=>{this.headerGrid.current.scrollTo({scrollLeft:e})},this.handleContainerResize=e=>{this.setState({dimensions:e.bounds})}}static getDerivedStateFromProps(e,t){const n=e.queryResult,a=t.columnWidths;return n&&n.columns&&n.columns.forEach(e=>{const t=e.name,n=e.maxValueLength;if(!a[t]){let e=n||8;t.length>e&&(e=t.length);let r=20*e;r<100?r=100:r>350&&(r=350),a[t]=r}}),{columnWidths:a}}getRowHeight(){return 30}render(){const e=this.props.queryResult,t=this.state.dimensions,n=t.height,a=t.width;if(e&&e.rows&&e.columns){const t=e.rows.length,l=e.columns.length+1;return r.a.createElement(ln.a,{bounds:!0,onResize:this.handleContainerResize},({measureRef:e})=>r.a.createElement("div",{ref:e,className:"h-100 w-100"},r.a.createElement(en.b,{columnCount:l,rowCount:1,columnWidth:this.getColumnWidth,rowHeight:this.getRowHeight,height:30,width:a,ref:this.headerGrid,style:cn},this.HeaderCell),r.a.createElement(en.b,{columnCount:l,rowCount:t,columnWidth:this.getColumnWidth,rowHeight:this.getRowHeight,width:a,height:n-30,ref:this.bodyGrid,onScroll:this.handleGridScroll},this.Cell)))}return null}}var dn=un;var mn=function({isRunning:e,queryError:t,queryResult:n}){return e?r.a.createElement(me,null):t?r.a.createElement(fe,null,t):n&&n.rows?"finished"===n.status&&0===n.rows.length?r.a.createElement($t,null,"Query finished",r.a.createElement("br",null),"No rows returned"):r.a.createElement(dn,{queryResult:n}):null};var pn=({index:e,filter:t,onChange:n,onAddFilter:a,onRemoveFilter:l})=>{const c={greaterThan:{key:"gt",label:"Greater than"},lowerThan:{key:"lt",label:"Lower than"},equals:{key:"eq",label:"Equals"},notEqual:{key:"ne",label:"Not equal"},before:{key:"before",label:"Before"},after:{key:"after",label:"After"},contains:{key:"contains",label:"Contains"}},i={userEmail:{label:"userEmail",operators:[c.contains]},connectionName:{label:"connectionName",operators:[c.contains]},startTime:{label:"startTime",operators:[c.before,c.after]},durationMs:{label:"durationMs",operators:[c.greaterThan,c.lowerThan]},queryId:{label:"queryId",operators:[c.contains]},queryName:{label:"queryName",operators:[c.contains]},queryText:{label:"queryText",operators:[c.contains]},rowCount:{label:"rowCount",operators:[c.lowerThan,c.greaterThan,c.equals,c.notEqual]}},o=[];return l&&o.push(r.a.createElement(R,{key:"removeFilter",htmlType:"button",style:{width:"20px"},onClick:t=>l(e)},"-")),a&&o.push(r.a.createElement(R,{key:"addFilter",htmlType:"button",style:{width:"20px"},onClick:a},"+")),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(lt,{style:{width:"200px",marginRight:8},name:"field",value:t.field,onChange:t=>n(e,{field:t.target.value,operator:i[t.target.value].operators[0].key})},Object.keys(i).map(e=>r.a.createElement("option",{key:e,value:e},i[e].label))),r.a.createElement(lt,{style:{width:"150px",marginRight:8},name:"operator",value:t.operator,onChange:t=>n(e,{operator:t.target.value})},i[t.field].operators.map(e=>r.a.createElement("option",{key:e.key,value:e.key},e.label))),r.a.createElement(A,{style:{width:"300px",marginRight:8},name:"value",value:t.value,onChange:t=>n(e,{value:t.target.value})}),o)};var fn=function(){const e=Object(a.useState)([]),t=Object(s.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)(""),o=Object(s.a)(c,2),u=o[0],d=o[1],m="/api/query-history?filter=".concat(u),p=Object(i.b)(m),f=p.data,h=p.isValidating,b=p.error,y=p.mutate,E={rows:f||[],columns:[{name:"userEmail",datatype:"string"},{name:"connectionName",datatype:"string"},{name:"startTime",datatype:"datetime"},{name:"stopTime",datatype:"datetime"},{name:"durationMs",datatype:"number"},{name:"queryId",datatype:"string"},{name:"queryName",datatype:"string"},{name:"queryText",datatype:"string"},{name:"incomplete",datatype:"boolean"},{name:"rowCount",datatype:"number"},{name:"createdAt",datatype:"datetime"}]}||{},g=(e,t)=>{const a=[...n];"field"in t&&(a[e].field=t.field),"operator"in t&&(a[e].operator=t.operator),"value"in t&&(a[e].value=t.value),l(a)},v=()=>{const e=[...n];e.push({field:"userEmail",operator:"contains",value:""}),l(e)},w=e=>{const t=[...n];t.splice(e,1),l(t)},x=e=>{d(n.map(e=>{if(["before","after"].includes(e.operator))try{e.value=new Date(e.value).toISOString()}catch(t){e.value=t.message}return"".concat(e.field,"|").concat(e.operator,"|").concat(e.value)}).join(","))};let C;const k=[r.a.createElement(R,{style:{width:135},key:"refresh",variant:"primary",onClick:()=>{y()},disabled:h},h?"Searching...":"Refresh")];0===n.length?k.unshift(r.a.createElement(R,{style:{width:135,marginRight:8},key:"addFilter",variant:"primary",onClick:v},"Add Filter")):C=r.a.createElement("form",{onSubmit:x,autoComplete:"off",style:{display:"flex",flexDirection:"column",height:"100%"}},r.a.createElement("p",null,"Display queries that meet all of the following criteria:"),n.map((e,t)=>r.a.createElement(pn,{index:t,key:t,filter:e,onChange:g,onAddFilter:t===n.length-1?v:null,onRemoveFilter:w})),r.a.createElement("br",null),r.a.createElement(R,{htmlType:"submit",style:{width:120},variant:"primary",onClick:x,disabled:h},h?"Searching...":"Search")," ");let O=null;return E&&E.rows&&(O=r.a.createElement("div",null,E.rows.length," rows")),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},k),r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},C),r.a.createElement("br",null),O,r.a.createElement("div",{style:{display:"flex",flexGrow:1,height:"100%"}},r.a.createElement("div",{style:{position:"relative",width:"100%",height:300,border:"1px solid #CCC"}},r.a.createElement(mn,{isRunning:h,queryResult:E,queryError:b}))))};var hn=function({visible:e,onClose:t}){return r.a.createElement(Tt,{width:"90%",title:"Query History",visible:e,onClose:t},r.a.createElement(fn,null))};var bn=r.a.memo((function(){const e=j().currentUser,t=Object(a.useState)(!1),n=Object(s.a)(t,2),l=n[0],c=n[1];return e?"noauth"!==e.id||"editor"!==e.role?r.a.createElement("div",null,r.a.createElement(R,{variant:"ghost",onClick:()=>c(!0)},"History"),r.a.createElement(hn,{visible:l,onClose:()=>c(!1)})):void 0:null})),yn=n(165),En=n.n(yn);var gn=function(){return r.a.createElement("div",{className:En.a.logo},"SQLPad")},vn=n(106),wn=n.n(vn),xn=n(166),Cn=n(262),kn=n(75),On=n(47),jn=n.n(On),Sn=n(187);const In=function(e){let t=e.isActive,n=e.isSelected,a=Object(I.a)(e,["isActive","isSelected"]);const l=[jn.a.item];return t&&l.push(jn.a.itemActive),n&&l.push(jn.a.itemSelected),r.a.createElement("li",Object.assign({className:l.join(" ")},a))},qn=r.a.forwardRef((e,t)=>{let n=e.isOpen,a=Object(I.a)(e,["isOpen"]);const l=[jn.a.menu],c={};return n||(c.border="none"),r.a.createElement("ul",Object.assign({ref:t,className:l.join(" "),style:c},a))});function Tn(e,t,n){const a={};t.forEach(e=>a[e.id]=e);const r=e.filter(e=>!a[e.id]);return n?Object(Sn.a)(r,n,{keys:["name"]}):r}var _n=n(94),Nn=n.n(_n);var Rn=function({children:e,onClose:t}){return r.a.createElement("div",{className:Nn.a.tagContainer},r.a.createElement("span",null,e),t&&r.a.createElement("button",{onClick:e=>{e.stopPropagation(),t()},className:Nn.a.tagCloseButton},r.a.createElement(Ue.a,{size:14,className:Nn.a.CloseIcon})))};var Ln=function({selectedItems:e=[],options:t,onChange:n,placeholder:l}){const c=Object(a.useRef)(),i=t=>{n(e.filter(e=>e!==t))},o=(t,a)=>{n([...e,t])};return r.a.createElement(kn.a,{itemToString:e=>e?e.name:"",stateReducer:(e,t)=>{switch(t.type){case kn.a.stateChangeTypes.keyDownArrowUp:return Object(Te.a)({},t,{isOpen:0!==e.highlightedIndex&&e.isOpen});case kn.a.stateChangeTypes.keyDownEnter:case kn.a.stateChangeTypes.clickItem:return Object(Te.a)({},t,{highlightedIndex:0,isOpen:!1,inputValue:""});default:return t}},onChange:t=>{const a=()=>{n(e)};e.includes(t)?i(t):o(t,a)},selectedItem:null},({getInputProps:n,getMenuProps:a,setState:o,selectItem:s,isOpen:u,inputValue:d,getItemProps:m,highlightedIndex:p,toggleMenu:f})=>r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("div",{className:jn.a.container,style:u?{borderBottomRightRadius:0,borderBottomLeftRadius:0}:null,onClick:()=>{f(),!u&&c.current.focus()}},e.length>0?e.map(e=>r.a.createElement(Rn,{key:e.id,onClose:()=>i(e)},e.component||e.name)):null,r.a.createElement("input",Object.assign({className:jn.a.input,placeholder:l},n({ref:c,onKeyDown(n){if("Enter"===n.key&&d.trim()&&null===p){if(!e.find(e=>e.name===d.toLowerCase())){const n=Tn(t,e,d).find(e=>e.name.toLowerCase()===d.toLowerCase()||e.id.toLowerCase()===d.toLowerCase());s(n||{id:d,name:d})}o({inputValue:"",isOpen:!1})}"Backspace"!==n.key||d||i(e[e.length-1]),"Escape"!==n.key||u||(n.nativeEvent.preventDownshiftDefault=!0)}})))),r.a.createElement(qn,a({isOpen:u}),u?Tn(t,e,d).map((t,n)=>r.a.createElement(In,Object.assign({key:t.id},m({item:t,index:n,isActive:p===n,isSelected:e.includes(t)})),t.component||t.name)):null)))},Dn=n(36),An=n.n(Dn);var Bn=e=>{let t=e.style;Object(I.a)(e,["style"]);const n=Object.assign({height:16},t);return r.a.createElement("div",{style:n},r.a.createElement("div",{style:{height:8,borderBottom:"1px solid #e8e8e8"}}))},Qn=n(90),zn=n.n(Qn);n(247);n(142),n(143);const Fn=()=>{};function Un({onChange:e,readOnly:t,value:n,onSelectionChange:l}){const c=j().config,i=Object(a.useState)({width:-1,height:-1}),o=Object(s.a)(i,2),u=o[0],d=o[1],m=Object(a.useState)(null),p=Object(s.a)(m,2),f=p[0],h=p[1];Object(a.useEffect)(()=>{f&&e&&(f.commands.on("afterExec",e=>{"insertstring"===e.command.name&&/^[\w.]$/.test(e.args)&&"."===e.args&&f.execCommand("startAutocomplete")}),f.session.setUseWrapMode(Boolean(c.editorWordWrap)))},[f,e,c]);const b=e=>{if(f&&f.session){const t=f.session.getTextRange(e.getRange());l(t)}},y=u.width,E=u.height,g={useWorker:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!1,showLineNumbers:!0,tabSize:2};return r.a.createElement(ln.a,{bounds:!0,onResize:e=>d(e.bounds)},({measureRef:a})=>r.a.createElement("div",{ref:a,className:"h-100 w-100"},r.a.createElement(zn.a,{editorProps:{$blockScrolling:1/0},focus:!t,height:E+"px",highlightActiveLine:!1,mode:"sql",name:"query-ace-editor",onChange:e||Fn,onLoad:e=>h(e),onSelectionChange:b,readOnly:t,setOptions:g,showGutter:!1,showPrintMargin:!1,theme:"sqlserver",value:n,width:y+"px"})))}Un.defaultProps={onSelectionChange:()=>{},readOnly:!1,value:""};var Pn=r.a.memo(Un),Mn=n(120),Wn=n.n(Mn);var Hn=function({query:e}){if(!e)return null;let t=e.createdBy;e.createdByUser&&(t=e.createdByUser.name||e.createdByUser.email);const n=e.connection&&e.connection.name;return r.a.createElement("div",{className:Wn.a.preview},r.a.createElement("div",null,r.a.createElement("div",{className:Wn.a.previewQueryName},e.name),r.a.createElement("div",null,"Connection ",n),r.a.createElement("div",null,"By ",t),r.a.createElement("div",null,e.tags&&e.tags.map(e=>r.a.createElement(Rn,{key:e},e)))),r.a.createElement(Bn,null),r.a.createElement("div",{style:{flexGrow:1,display:"flex"}},r.a.createElement(Pn,{readOnly:!0,value:e.queryText||""})))};var Gn=r.a.memo((function({onClose:e,visible:t}){const n=Object(a.useState)(null),l=Object(s.a)(n,2),c=l[0],o=l[1],u=Object(a.useState)(""),d=Object(s.a)(u,2),m=d[0],p=d[1],f=Object(a.useState)([]),b=Object(s.a)(f,2),y=b[0],g=b[1],x=Object(a.useState)("ALL"),C=Object(s.a)(x,2),k=C[0],O=C[1],j=Object(a.useState)("SAVE_DATE"),S=Object(s.a)(j,2),I=S[0],q=S[1],T=Object(a.useState)(""),_=Object(s.a)(T,2),N=_[0],R=_[1],L=Object(a.useState)({width:-1,height:-1}),D=Object(s.a)(L,2),B=D[0],Q=D[1],z=Object(Cn.a)(m,400),F=Object(s.a)(z,1)[0],U=Object(a.useState)([]),M=Object(s.a)(U,2),W=M[0],H=M[1],G=Object(a.useState)(!1),V=Object(s.a)(G,2),Y=V[0],X=V[1],K=Object(a.useState)(null),J=Object(s.a)(K,2),Z=J[0],$=J[1],ee=Object(a.useState)(null),te=Object(s.a)(ee,2),ne=te[0],ae=te[1];let re={limit:20};re.sortBy="SAVE_DATE"===I?"-updatedAt":"+name","MY_QUERIES"===k?re.ownedByUser=!0:"SHARED"===k&&(re.ownedByUser=!1),F&&(re.search=F),N&&(re.connectionId=N),y&&y.length>0&&(re.tags=y.map(e=>e.id).sort());const le="/api/queries?"+wn.a.stringify(re,{arrayFormat:"bracket"}),ie=Object(a.useCallback)(e=>{X(!0),P.get(e).then(t=>{const n=t.data,a=t.links,r=t.error;X(!1),ae(r),a&&a.next?$(a.next.url):$(null),H(e===le?n:e=>e.concat(n))})},[le]);Object(a.useEffect)(()=>{t&&ie(le)},[t,le,ie]);const oe=Object(i.b)("/api/tags").data||[],se=Object(i.b)("/api/connections").data||[],ue=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.delete("/api/queries/".concat(t));case 2:if(n=e.sent,!(a=n.error)){e.next=6;break}return e.abrupt("return",h(a));case 6:H(e=>e.filter(e=>e.id!==t)),o(null);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function me(){o(null),e()}const pe=({index:e,style:t})=>{const n=W[e],a="/query-table/".concat(n.id),l="/query-chart/".concat(n.id),c="/queries/".concat(n.id),i=n&&n.chart&&n.chart.chartType;return r.a.createElement(tt,{key:n.id,className:An.a.ListItem,onMouseEnter:()=>o(n),onMouseLeave:()=>o(null),style:t},r.a.createElement(E.b,{className:An.a.queryLink,to:c,onClick:me},n.name,r.a.createElement("br",null),r.a.createElement(ce,{type:"secondary"},n.connection.name)),r.a.createElement("div",{className:An.a.listItemActions},r.a.createElement(E.b,{className:An.a.newWindowLink,to:a,target:"_blank",rel:"noopener noreferrer"},"table ",r.a.createElement(Vt.a,{size:16})),r.a.createElement("div",{style:{width:8}}),r.a.createElement(E.b,{className:An.a.newWindowLink,to:l,target:"_blank",rel:"noopener noreferrer",disabled:!Boolean(i)},"chart ",r.a.createElement(Vt.a,{size:16})),r.a.createElement("div",{style:{width:4}}),r.a.createElement(Ze,{icon:!0,key:"del",confirmMessage:"Delete ".concat(n.name),onConfirm:e=>ue(n.id),disabled:!n.canDelete},"Delete")))},he=()=>{!Y&&Z&&ie(Z)};return r.a.createElement(He,{title:"Queries",visible:t,width:"600px",onClose:me,placement:"left"},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%"}},r.a.createElement("div",{className:An.a.filterContainer},r.a.createElement("div",{className:An.a.filterRow},r.a.createElement(lt,{style:{width:140,marginRight:8,flex:"0 0 auto"},value:k,onChange:e=>O(e.target.value)},r.a.createElement("option",{value:"MY_QUERIES"},"My queries"),r.a.createElement("option",{value:"SHARED"},"Shared with me"),r.a.createElement("option",{value:"ALL"},"All queries")),r.a.createElement(lt,{style:{marginRight:8},value:N,onChange:e=>R(e.target.value)},r.a.createElement("option",{value:""},"All connections"),se.map(e=>r.a.createElement("option",{key:e.id,value:e.id},e.name))),r.a.createElement(lt,{style:{width:170,flex:"0 0 auto"},value:I,onChange:e=>q(e.target.value)},r.a.createElement("option",{value:"SAVE_DATE"},"Order by last saved"),r.a.createElement("option",{value:"NAME"},"Order by name"))),r.a.createElement("div",{className:An.a.filterRow},r.a.createElement("div",{style:{flex:"1 1 auto",width:"50%"}},r.a.createElement(A,{style:{height:36},placeholder:"search",value:m,onChange:e=>p(e.target.value)})),r.a.createElement("div",{style:{width:8}}),r.a.createElement("div",{style:{flex:"1 1 auto",width:"50%"}},r.a.createElement(Ln,{selectedItems:y,options:oe.map(e=>({id:e,name:e})),onChange:e=>g(e),placeholder:"tags"})))),r.a.createElement(ln.a,{bounds:!0,onResize:e=>{Q(e.bounds)}},({measureRef:e})=>r.a.createElement("div",{ref:e,style:{display:"flex",width:"100%",height:"100%"}},Y&&0===W.length&&r.a.createElement("div",{className:"h-100 w-100 flex-center"},r.a.createElement(de,null)),ne&&r.a.createElement(fe,null,"Error getting queries"),!ne&&!Y&&0===W.length&&r.a.createElement("div",{style:{height:150,width:"100%"}},r.a.createElement($t,null,"No queries found")),!ne&&W.length>0&&r.a.createElement(xn.a,{isItemLoaded:e=>e<W.length,itemCount:1e3,loadMoreItems:he},({onItemsRendered:e,ref:t})=>r.a.createElement(en.a,{style:{position:"absolute"},ref:t,onItemsRendered:e,height:B.height,itemCount:W.length,itemSize:60,width:B.width,overscanCount:2},pe)))),r.a.createElement(Hn,{key:c&&c.id,query:c})))}));var Vn=r.a.memo((function(){const e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],l=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{variant:"ghost",onClick:()=>l(!0)},"Queries"),r.a.createElement(Gn,{visible:n,onClose:()=>l(!1)}))}));function Yn(e,t){return C.a.setItem("queryText:".concat(e),t).catch(e=>console.error(e))}function Xn(e){return C.a.getItem("queryText:".concat(e)).catch(e=>console.error(e))}function Kn(e){return C.a.removeItem("queryText:".concat(e)).catch(e=>console.error(e))}const Jn={id:"",name:"",tags:[],connectionId:"",queryText:"",chart:{chartType:"",fields:{}},canRead:!0,canWrite:!0,canDelete:!0},Zn={isRunning:!1,isSaving:!1,query:Object.assign({},Jn),queryError:void 0,queryResult:void 0,runQueryStartTime:void 0,selectedText:"",showValidation:!1,unsavedChanges:!1},$n=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query,e.next=3,P.post("/api/format-sql",{query:n.queryText});case 3:if(!(a=e.sent).error){e.next=7;break}return h(a.error),e.abrupt("return");case 7:if(a.data&&a.data.query){e.next=10;break}return console.warn("unexpected API result"),e.abrupt("return");case 10:return Yn(n.id,a.data.query),e.abrupt("return",{query:Object(Te.a)({},n,{queryText:a.data.query}),unsavedChanges:!0});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ea=function(){var e=Object(w.a)(v.a.mark((function e(t,n){var a,r,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.get("/api/queries/".concat(n));case 2:if(a=e.sent,r=a.error,l=a.data,!r){e.next=7;break}return e.abrupt("return",h("Query not found"));case 7:return e.abrupt("return",{runQueryInstanceId:null,isRunning:!1,query:l,queryError:void 0,queryResult:void 0,selectedConnectionId:l.connectionId,unsavedChanges:!1});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ta=e=>function(){var t=Object(w.a)(v.a.mark((function t(n){var a,r,l,c,i,o,s,u,d;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.query,r=n.selectedText,l=n.selectedConnectionId,c=n.connectionClient,i=Object(Qt.a)(),e.setState({runQueryInstanceId:i,isRunning:!0,runQueryStartTime:new Date}),o={connectionId:l,connectionClientId:c&&c.id,queryId:a.id,name:a.name,batchText:a.queryText,selectedText:r,chart:a.chart},t.next=6,Ne(o);case 6:s=t.sent,u=s.data,d=s.error,e.getState().runQueryInstanceId===i&&e.setState({isRunning:!1,queryError:d,queryResult:u});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),na=e=>function(){var t=Object(w.a)(v.a.mark((function t(n){var a,r,l;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.query,r=n.selectedConnectionId,a.name){t.next=5;break}return h("Query name required"),e.setState({showValidation:!0}),t.abrupt("return");case 5:e.setState({isSaving:!0}),l=Object.assign({},a,{connectionId:r}),a.id?P.put("/api/queries/".concat(a.id),l).then(t=>{const n=t.error,a=t.data;if(n)return h(n),void e.setState({isSaving:!1});Object(i.c)("/api/queries"),b("Query Saved"),Kn(a.id),e.setState({isSaving:!1,unsavedChanges:!1,query:a})}):P.post("/api/queries",l).then(t=>{const n=t.error,a=t.data;if(n)return h(n),void e.setState({isSaving:!1});Object(i.c)("/api/queries"),window.history.replaceState({},a.name,"".concat(window.BASE_URL,"/queries/").concat(a.id)),b("Query Saved"),Kn(a.id),e.setState({isSaving:!1,unsavedChanges:!1,query:a})});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),aa=e=>{const t=e.query;delete t.id;const n="Copy of "+t.name;return window.history.replaceState({},n,"".concat(window.BASE_URL,"/queries/new")),{query:Object(Te.a)({},t,{name:n}),unsavedChanges:!0}},ra=e=>({runQueryInstanceId:null,isRunning:!1,query:Object.assign({},Jn),queryError:void 0,queryResult:void 0,unsavedChanges:!1}),la=(e,t,n)=>{const a=e.query;return"queryText"===t&&Yn(a.id,n),{query:Object(Te.a)({},a,{[t]:n}),unsavedChanges:!0}},ca=(e,t,n)=>{const a=e.query,r=a.chart.fields;return{query:Object(Te.a)({},a,{chart:Object(Te.a)({},a.chart,{fields:Object(Te.a)({},r,{[t]:n})})}),unsavedChanges:!0}},ia=(e,t)=>{const n=e.query;return{query:Object(Te.a)({},n,{chart:Object(Te.a)({},n.chart,{chartType:t})}),unsavedChanges:!0}},oa=(e,t)=>({selectedText:t});var sa={formatQuery:$n,handleChartConfigurationFieldsChange:ca,handleChartTypeChange:ia,handleCloneClick:aa,handleQuerySelectionChange:oa,initialState:Zn,loadQuery:ea,resetNewQuery:ra,runQuery:ta,saveQuery:na,setQueryState:la};var ua=Object(o.connect)((function(e){return{}}),e=>({resetNewQuery:ra}))(r.a.memo((function({resetNewQuery:e}){return r.a.createElement(R,{variant:"ghost",to:"/queries/new",tooltip:"New query",onClick:()=>e()},"New")})));const da={flexShrink:0,flexGrow:1,width:8},ma={flexShrink:0,width:8};var pa=function({grow:e}){return e?r.a.createElement("div",{style:da}):r.a.createElement("div",{style:ma})},fa=n(168),ha=n.n(fa);var ba=r.a.memo((function(){const e=j().currentUser;return e&&"noauth"!==e.id?r.a.createElement("div",{className:ha.a.style}," ",e.name||e.email):null}));var ya=r.a.memo((function(){return r.a.createElement("div",{style:{width:"100%",color:"#fff",backgroundColor:"rgba(0, 0, 0, 0.84)",padding:6,borderBottom:"1px solid rgb(204, 204, 204)"}},r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(gn,null),r.a.createElement(Vn,null),r.a.createElement(ua,null),r.a.createElement(bn,null),r.a.createElement(Mt,null),r.a.createElement(pa,{grow:!0}),r.a.createElement(ba,null),r.a.createElement(Zt,null)))})),Ea=n(71),ga=(n(248),function(e){if(va("updating completions"),va(e),null===e||void 0===e)return;const t=[],n=[],a={schema:{},table:{},schemaTable:{}};Object.keys(e).forEach(r=>{t.push({name:r,value:r,score:0,meta:"schema"});const l=r.toUpperCase();a.schema[l]||(a.schema[l]=[]),Object.keys(e[r]).forEach(t=>{const c=l+"."+t.toUpperCase(),i=t.toUpperCase();a.table[i]||(a.table[i]=[]),a.schemaTable[c]||(a.schemaTable[c]=[]);const o={name:t,value:t,score:0,meta:"table",schema:r};n.push(o),a.schema[l].push(o),e[r][t].forEach(e=>{const n={name:r+t+e.column_name,value:e.column_name,score:0,meta:"column",schema:r,table:t};a.table[i].push(n),a.schemaTable[c].push(n)})})});const r=t.concat(n),l={getCompletions:function(e,t,n,l,c){const i=t.getValue().split(/\s+/).map(e=>e.toUpperCase()),o={};Object.keys(a.schemaTable).forEach(e=>{if(i.indexOf(e)>=0){o[e]=a.schemaTable[e];const t=a.schemaTable[e][0].table.toUpperCase();o[t]=a.table[t]}}),Object.keys(a.table).forEach(e=>{if(i.indexOf(e)>=0){o[e]=a.table[e];const t=a.table[e][0],n=t.schema.toUpperCase()+"."+t.table.toUpperCase();o[n]=a.table[e]}}),va("matched found: ",Object.keys(o));let s=[];Object.keys(o).forEach(e=>{s=s.concat(o[e])});const u={},d={},m=[];s.forEach(e=>{e.schema&&(u[e.schema]=e.schema),e.table&&(d[e.table]=e.schema)}),Object.keys(u).forEach(e=>{m.push({name:e,value:e,score:0,meta:"schema"})}),Object.keys(d).forEach(e=>{const t={name:e,value:e,score:0,meta:"table"};m.push(t);const n=d[e].toUpperCase();o[n]||(o[n]=[]),o[n].push(t)});const p=["FROM","JOIN"],f=["SELECT","WHERE","GROUP","HAVING","ON"];let h="";const b=n.row;for(let a=b;a>=0;a--){let e,r=t.getDocument().getLine(a);a===b&&(r=r.slice(0,n.column)),e=r.split(/\s+/).map(e=>e.toUpperCase());for(let t=e.length-1;t>=0;t--){const n=e[t];if(f.indexOf(n)>=0){va("WANT COLUMN BECAUSE FOUND: ",n),h="COLUMN",a=0;break}if(p.indexOf(n)>=0){va("WANT TABLE BECAUSE FOUND: ",n),h="TABLE",a=0;break}}}va("WANTED: ",h);const y=t.getDocument().getLine(n.row),E=y.slice(0,n.column).split(/\s+/).map(e=>e.toUpperCase()),g=y.slice(n.column-1,n.column),v=E[E.length-1];if(va('PREFIX: "%s"',l),va('PRECEDING CHAR: "%s"',g),va('PRECEDING TOKEN: "%s"',v),v.indexOf(".")>=0){let e=v.split(".");e.pop();const t=e.join(".").toUpperCase();if(va('Completing for "%s" even though we got "%s"',t,v),"TABLE"===h)return c(null,a.schema[t]);if("COLUMN"===h)return c(null,o[t])}return"TABLE"===h?c(null,r):"COLUMN"===h?c(null,s.concat(m)):void c(null,null)}};Ea.acequire(["ace/ext/language_tools"],e=>{e.setCompleters([l])})});function va(){0}const wa=r.a.createContext();function xa({children:e}){const t={state:{},emitter:Object(m.a)()};return r.a.createElement(wa.Provider,{value:t},e)}function Ca(e,t){const n=Object(a.useContext)(wa);if(void 0===n)throw new Error("useKeyState must be used within a KeyStateProvider");const r=n.state,l=n.emitter;r[e]||(r[e]=t);const c=Object(a.useState)(r[e]),i=Object(s.a)(c,2),o=i[0],u=i[1];return Object(a.useEffect)(()=>(l.on(e,u),()=>l.off(e,u)),[l,e]),[o,Object(a.useCallback)(t=>{r[e]=t,l.emit(e,t),u(t)},[l,r,e])]}var ka=function(){const e=Ca("showSchema",!0),t=Object(s.a)(e,2),n=t[0],r=t[1],l=Ca("schema",{}),c=Object(s.a)(l,2),i=c[0],o=c[1],u=Object(a.useCallback)(()=>{r(e=>!e)},[r]),d=Object(a.useCallback)(function(){var e=Object(w.a)(v.a.mark((function e(t,a){var r,l,c,s,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i[t]&&!a){e.next=15;break}return o(Object(Te.a)({},i,{[t]:{loading:!0,expanded:{}}})),r=a?"?reload=true":"",e.next=5,P.get("/api/schema-info/".concat(t).concat(r));case 5:if(l=e.sent,c=l.error,s=l.data,!c){e.next=11;break}return o(Object(Te.a)({},i,{[t]:{loading:!1,error:c}})),n||h(c),e.abrupt("return");case 11:ga(s),u={},s&&Object.keys(s).forEach(e=>{u[e]=!0}),o(Object(Te.a)({},i,{[t]:{loading:!1,schemaInfo:s,error:null,expanded:u}}));case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[i,n,o]),m=Object(a.useCallback)((e,t)=>{const n=i[e],a=!n.expanded[t.id];o(Object(Te.a)({},i,{[e]:Object(Te.a)({},n,{expanded:Object(Te.a)({},n.expanded,{[t.id]:a})})}))},[i,o]);return{showSchema:n,schema:i,toggleSchema:u,loadSchemaInfo:d,toggleSchemaItem:m}};var Oa=Object(o.connect)((function(e,t){return{connectionId:e.selectedConnectionId}}))((function({connectionId:e}){const t=ka().loadSchemaInfo;return Object(a.useEffect)(()=>{e&&t(e)},[e,t]),null})),ja=n(169),Sa=n.n(ja),Ia=n(170),qa=n.n(Ia),Ta=n(171),_a=n.n(Ta);function Na({children:e}){return r.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%",padding:"8px",overflowY:"auto",overflowX:"hidden"}},e)}var Ra=n(68),La=n.n(Ra);function Da(e,t){const n={},a=new RegExp(t,"i");return e&&Object.keys(e).forEach(t=>{const r=function(e,t){const n={};return Object.keys(e).forEach(a=>{(t.test(a)||e[a].some(e=>t.test(e.column_name)))&&(n[a]=e[a])}),n}(e[t],a);n[t]=r}),n}const Aa={marginBottom:-6,marginRight:-6,marginLeft:-4};var Ba=Object(o.connect)((function(e,t){return{connectionId:e.selectedConnectionId}}))(r.a.memo((function({connectionId:e}){const t=Object(a.useState)(""),n=Object(s.a)(t,2),l=n[0],c=n[1],i=Object(a.useState)({width:-1,height:-1}),o=Object(s.a)(i,2),u=o[0],d=o[1],m=t=>{t.preventDefault(),e&&h(e,!0)},p=ka(),f=p.toggleSchemaItem,h=p.loadSchemaInfo,b=p.schema,y=b&&b[e]||{},E=y.loading,g=y.schemaInfo,v=y.expanded,w=y.error,x=function(e){const t=[];return e&&Object.keys(e).forEach(n=>{const a=n;t.push({type:"schema",name:n,id:a,parentIds:[]}),Object.keys(e[n]).forEach(r=>{const l="".concat(n,".").concat(r);t.push({type:"table",name:r,schemaName:n,id:l,parentIds:[a]}),e[n][r].forEach(e=>{const c="".concat(n,".").concat(r,".").concat(e.column_name);t.push({type:"column",name:e.column_name,description:e.column_description,dataType:e.data_type,tableName:r,schemaName:n,id:c,parentIds:[a,l]})})})}),t}(Da(g,l)).filter(e=>e.parentIds.every(e=>v[e])),C=({index:t,style:n})=>{const a=x[t],l=v[a.id]?Sa.a:qa.a;if(!a)return null;if("schema"===a.type)return r.a.createElement("li",{key:a.name,className:La.a.schema,style:n,onClick:()=>f(e,a)},r.a.createElement(l,{size:22,style:Aa})," ",a.name);if("table"===a.type)return r.a.createElement("li",{key:"".concat(a.schemaName,".").concat(a.name),className:La.a.table,style:n,onClick:()=>f(e,a)},r.a.createElement(l,{size:22,style:Aa})," ",a.name);if("column"===a.type){const e=[r.a.createElement("span",{key:"colType"}," ",a.dataType)];if(a.description){const t=r.a.createElement(N,{key:"colDesc",label:a.description,style:{"max-width":"300px","white-space":"normal"}},r.a.createElement("span",{className:La.a.description}," - ",a.description));e.push(t)}return r.a.createElement("li",{key:"".concat(a.schemaName,".").concat(a.tableName,".").concat(a.name),className:La.a.column,style:n},a.name,r.a.createElement(ce,{type:"secondary"},e))}};let k=null;return k=w?r.a.createElement(fe,null,w):E?r.a.createElement("div",{className:La.a.schemaSpinner},r.a.createElement(de,null)):r.a.createElement("ul",{style:{paddingLeft:0}},r.a.createElement(en.a,{style:{position:"absolute"},height:u.height,itemCount:x.length,itemSize:22,width:u.width,overscanCount:10},C)),r.a.createElement(ln.a,{bounds:!0,onResize:e=>{d(e.bounds)}},({measureRef:e})=>r.a.createElement(Na,null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(A,{value:l,placeholder:"Search schema",onChange:e=>c(e.target.value)}),r.a.createElement(We,{tooltip:"Refresh schema",style:{marginLeft:8},disabled:E,onClick:m},r.a.createElement(_a.a,null))),r.a.createElement(Bn,{style:{margin:"4px 0"}}),r.a.createElement("div",{style:{display:"flex",flexGrow:1}},r.a.createElement("div",{ref:e,style:{display:"flex",width:"100%"}},k))))})));var Qa=Object(o.connect)((function(e,t){const n=e.query&&e.query.name;return{title:"new"===t.queryId?"New query":n}}))((function({title:e}){return Object(a.useEffect)(()=>{document.title=e},[e]),null}));var za=Object(o.connect)((function(e){return{queryId:e.query&&e.query.id||"new",isRunning:e.isRunning,queryResult:e.queryResult,chartConfiguration:e.query&&e.query.chart}}))(qe);var Fa=Object(o.connect)((function(e){return{queryId:e.query&&e.query.id||"new",queryName:e.query&&e.query.name||"New query",queryResult:e.queryResult}}))((function({queryResult:e,queryId:t,queryName:n,children:a}){const l=e&&e.rows&&e.rows.length;return r.a.createElement("div",{style:{display:"flex",flexDirection:"column"},className:"h-100 w-100"},r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"center",padding:4}},r.a.createElement(We,{disabled:"new"===t,to:"/query-chart/".concat(t),target:"_blank",rel:"noopener noreferrer",tooltip:"Open chart in new window"},r.a.createElement(Vt.a,null)),r.a.createElement(We,{disabled:!l,onClick:()=>Ie(t,n),tooltip:"Save chart image"},r.a.createElement(K.a,null))),r.a.createElement("div",{style:{display:"flex",padding:8,position:"relative"},className:"h-100 w-100"},a))}));var Ua=Object(o.connect)(["isRunning","queryError","queryResult"])(mn);var Pa=Object(o.connect)((function(e,t){return{value:e.query&&e.query.queryText}}),{setQueryState:la,handleQuerySelectionChange:oa})((function({value:e,setQueryState:t,handleQuerySelectionChange:n}){const l=Object(a.useCallback)(e=>t("queryText",e),[t]);return r.a.createElement("div",{style:{padding:4,height:"100%",width:"100%"}},r.a.createElement(Pn,{value:e||"",onChange:l,onSelectionChange:n}))}));var Ma=function({startTime:e}){const t=Object(a.useState)(0),n=Object(s.a)(t,2),l=n[0],c=n[1];return Object(a.useEffect)(()=>{const t=setInterval(()=>{const t=new Date;c(((t-e)/1e3).toFixed(0))},33);return()=>clearInterval(t)},[e]),r.a.createElement("span",null,l)},Wa=n(22),Ha=n.n(Wa);function Ga({isRunning:e,queryId:t,queryResult:n,runQueryStartTime:a}){const l=j().config;if(e||!n)return r.a.createElement("div",{className:Ha.a.toolbar},e?r.a.createElement("span",{className:Ha.a.toolbarItem},"Query time: ",r.a.createElement(Ma,{startTime:a})):null);const c=n.rows||[],i=n.links||{},o=n.durationMs/1e3,s=c.length,u=Boolean(n.incomplete),d=c.length>0;return r.a.createElement("div",{className:Ha.a.toolbar},r.a.createElement("div",{className:Ha.a.toolbarItem},o," seconds"),r.a.createElement("div",{className:Ha.a.toolbarItem},s," rows"),r.a.createElement("div",{className:Ha.a.toolbarItem},l.allowCsvDownload&&d&&r.a.createElement("span",{className:Ha.a.iconLinkWrapper},r.a.createElement(E.b,{className:Ha.a.iconLink,target:"_blank",rel:"noopener noreferrer",to:i.csv},r.a.createElement(K.a,{style:{marginRight:4},size:16}),".csv"),r.a.createElement(E.b,{className:Ha.a.iconLink,target:"_blank",rel:"noopener noreferrer",to:i.xlsx},r.a.createElement(K.a,{style:{marginRight:4},size:16}),".xlsx"),r.a.createElement(E.b,{className:Ha.a.iconLink,target:"_blank",rel:"noopener noreferrer",to:i.json},r.a.createElement(K.a,{style:{marginRight:4},size:16}),".json"))),r.a.createElement("div",{className:Ha.a.toolbarItem},r.a.createElement("span",{className:Ha.a.iconLinkWrapper},r.a.createElement(E.b,{className:Ha.a.iconLink,target:"_blank",rel:"noopener noreferrer",to:i.table,disabled:!Boolean(t)||"new"===t},"table ",r.a.createElement(Vt.a,{style:{marginLeft:4},size:16})))),u&&r.a.createElement(ue,null))}Ga.defaultProps={isRunning:!1};var Va=Object(o.connect)((function(e){const t=e.isRunning,n=e.queryResult,a=e.runQueryStartTime;return{isRunning:t,queryId:e.query&&e.query.id,queryResult:n,runQueryStartTime:a}}))(r.a.memo(Ga)),Ya=n(49),Xa=n.n(Ya);var Ka=Object(o.connect)(null,e=>({connectConnectionClient:ut(e),formatQuery:$n,runQuery:ta(e),saveQuery:na(e)}))((function({connectConnectionClient:e,formatQuery:t,runQuery:n,saveQuery:r}){return Object(a.useEffect)(()=>(Xa.a.filter=()=>!0,Xa()("ctrl+s, command+s",e=>(r(),!1)),Xa()("ctrl+return, command+return",t=>(e().then(()=>n()),!1)),Xa()("shift+return",e=>(t(),!1)),()=>{Xa.a.unbind("ctrl+return, command+return"),Xa.a.unbind("ctrl+s, command+s"),Xa.a.unbind("shift+return")}),[r,n,e,t]),null})),Ja=n(172),Za=n.n(Ja);var $a=Object(o.connect)(["selectedConnectionId"],e=>({connectConnectionClient:ut(e),selectConnectionId:mt}))((function({connectConnectionClient:e,selectConnectionId:t,selectedConnectionId:n}){const l=j().currentUser,c=Object(a.useState)(!1),o=Object(s.a)(c,2),u=o[0],d=o[1],m=Object(a.useState)(!1),p=Object(s.a)(m,2),f=p[0],h=p[1];let b=Object(i.b)("/api/connections"),y=b.data,E=b.mutate;const g=y||[];if("editor"===l.role&&1===g.length)return null;const v=n?{width:220}:{color:"#777",width:220},w=n?null:Za.a.attention;return r.a.createElement(r.a.Fragment,null,r.a.createElement(lt,{style:v,className:w,value:n||void 0,onChange:n=>"new"===n.target.value?d(!0):"manage"===n.target.value?h(!0):(t(n.target.value),void e())},r.a.createElement("option",{value:""},"... choose connection"),g.map(e=>r.a.createElement("option",{key:e.id,value:e.id,name:e.name},e.name)),"admin"===l.role&&r.a.createElement("option",{value:"new"},"... New connection"),"admin"===l.role&&r.a.createElement("option",{value:"manage"},"... Manage connections")),r.a.createElement(Ot,{visible:u,placement:"left",onClose:()=>d(!1),onConnectionSaved:n=>{E(),t(n.id),d(!1),e()}}),r.a.createElement(St,{visible:f,onClose:()=>h(!1)}))})),er=n(173),tr=n.n(er);const nr={marginBottom:16,boxSizing:"border-box",width:"calc(1/2*100% - 8px)"};function ar({onChartConfigurationFieldsChange:e,queryChartConfigurationFields:t,queryResult:n,chartType:a}){const l=(t,n)=>{e(t,n)},c=he.find(e=>e.chartType===a);return c&&c.fields?r.a.createElement("div",{style:{overflowY:"auto",overflowX:"hidden",display:"flex",flexWrap:"wrap",alignContent:"flex-start",alignItems:"center",justifyContent:"space-between"}},(e=>{let a=[];return n&&n.columns&&(a=n.columns.map(e=>e.name)),e.map(e=>{if("field-dropdown"===e.inputType){const n=a.map(e=>r.a.createElement("option",{key:e,value:e},e)),c=t[e.fieldId];return c&&-1===a.indexOf(c)&&n.push(r.a.createElement("option",{key:"selectedQueryResultField",value:c},c)),r.a.createElement("div",{style:nr,key:e.fieldId},r.a.createElement("label",null,e.label),r.a.createElement(lt,{className:"w-100",value:c,onChange:t=>l(e.fieldId,t.target.value)},r.a.createElement("option",{value:""}),n))}if("checkbox"===e.inputType){const a=("string"===typeof(n=t[e.fieldId])&&("true"===n.toLowerCase()?n=!0:"false"===n.toLowerCase()&&(n=!1)),n||!1);return r.a.createElement("div",{style:nr,key:e.fieldId},r.a.createElement("input",{type:"checkbox",checked:a,id:e.fieldId,name:e.fieldId,onChange:t=>l(e.fieldId,t.target.checked)}),r.a.createElement("label",{htmlFor:e.fieldId,style:{marginLeft:8}},e.label))}if("textbox"===e.inputType){const n=t[e.fieldId]||"";return r.a.createElement("div",{style:nr,key:e.fieldId},r.a.createElement("label",null,e.label),r.a.createElement(A,{value:n,onChange:t=>l(e.fieldId,t.target.value),className:"w-100"}))}throw Error("field.inputType ".concat(e.inputType," not supported"));var n})})(c.fields)):null}ar.defaultProps={queryChartConfigurationFields:{},queryResult:{}};var rr=ar;var lr=Object(o.connect)((function(e){return{queryResult:e.queryResult,chartType:e.query&&e.query.chart&&e.query.chart.chartType,fields:e.query&&e.query.chart&&e.query.chart.fields}}),{handleChartConfigurationFieldsChange:ca,handleChartTypeChange:ia})(r.a.memo((function({chartType:e,fields:t,queryResult:n,handleChartConfigurationFieldsChange:a}){return r.a.createElement(rr,{chartType:e,queryChartConfigurationFields:t,onChartConfigurationFieldsChange:a,queryResult:n})})));var cr=Object(o.connect)((function(e){return{chartType:e.query&&e.query.chart&&e.query.chart.chartType}}),{handleChartTypeChange:ia})(r.a.memo((function({chartType:e,handleChartTypeChange:t,className:n,style:a}){const l=he.map(e=>r.a.createElement("option",{key:e.chartType,value:e.chartType},e.chartLabel));return r.a.createElement(lt,{className:n,onChange:e=>t(e.target.value),style:a,value:e},r.a.createElement("option",{value:""},"No visualization"),l)})));var ir=r.a.memo((function(){const e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],l=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(We,{tooltip:"Configure visualization",onClick:()=>l(!0)},r.a.createElement(tr.a,null)),r.a.createElement(Tt,{width:500,title:"Configure visualization",visible:n,onClose:()=>l(!1)},r.a.createElement(cr,null),r.a.createElement(B,{size:2}),r.a.createElement(lr,null),r.a.createElement(B,{size:2}),r.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(R,{variant:"primary",onClick:()=>l(!1)},"OK"))))})),or=n(174),sr=n.n(or);var ur=Object(o.connect)((function(e){return{queryId:e.query&&e.query.id}}),e=>({handleCloneClick:aa}))(r.a.memo((function({handleCloneClick:e,queryId:t}){const n=!t;return r.a.createElement(We,{tooltip:"Clone",onClick:e,disabled:n},r.a.createElement(sr.a,null))}))),dr=n(175),mr=n.n(dr),pr=n(176),fr=n.n(pr);var hr=Object(o.connect)(["connectionClient","selectedConnectionId"],e=>({connectConnectionClient:ut(e),disconnectConnectionClient:dt}))((function({connectionClient:e,selectedConnectionId:t,connectConnectionClient:n,disconnectConnectionClient:l}){const c=Object(a.useState)(!1),o=Object(s.a)(c,2),u=o[0],d=o[1],m=Object(i.b)("/api/connections").data||[];function p(){return(p=Object(w.a)(v.a.mark((function t(){return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d(!0),!e){t.next=6;break}return t.next=4,l();case 4:t.next=8;break;case 6:return t.next=8,n();case 8:d(!1);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}if(!m||0===m.length||!t)return null;const f=m.find(e=>e.id===t);return f&&f.supportsConnectionClient&&f.multiStatementTransactionEnabled?r.a.createElement(We,{onClick:function(){return p.apply(this,arguments)},disabled:u,tooltip:e?"Disconnect from database":"Connect to database"},e?r.a.createElement(mr.a,null):r.a.createElement(fr.a,null)):null})),br=n(177),yr=n.n(br);var Er=Object(o.connect)((function(e){return{}}),e=>({formatQuery:$n}))(r.a.memo((function({formatQuery:e}){return r.a.createElement(We,{tooltip:"Format",onClick:e},r.a.createElement(yr.a,null))})));var gr=Object(o.connect)((function(e){return{queryName:e.query&&e.query.name,showValidation:e.showValidation}}),e=>({setQueryState:la}))(r.a.memo((function({queryName:e,setQueryState:t,showValidation:n}){const a=n&&!e.length;return r.a.createElement(A,{error:a,style:{width:260},placeholder:"Query name",value:e,onChange:e=>t("name",e.target.value)})})));var vr=Object(o.connect)((function(e){return{isRunning:e.isRunning}}),e=>({connectConnectionClient:ut(e),runQuery:ta(e)}))(r.a.memo((function({isRunning:e,connectConnectionClient:t,runQuery:n}){return r.a.createElement(R,{variant:"primary",onClick:Object(w.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:n();case 3:case"end":return e.stop()}}),e)}))),disabled:e},"Run")}))),wr=n(178),xr=n.n(wr),Cr=n(179),kr=n.n(Cr);var Or=Object(o.connect)((function(e){return{isSaving:e.isSaving,unsavedChanges:e.unsavedChanges}}),e=>({saveQuery:na(e)}))(r.a.memo((function({isSaving:e,saveQuery:t,unsavedChanges:n}){return r.a.createElement(We,{tooltip:"Save",onClick:()=>t(),disabled:e},n?r.a.createElement(xr.a,null):r.a.createElement(kr.a,null))}))),jr=n(180),Sr=n.n(jr),Ir=n(181),qr=n.n(Ir);var Tr=Object(o.connect)((function(e){return{shared:(e.query.acl||[]).length>0}}),e=>({setQueryState:la}))(r.a.memo((function({shared:e,setQueryState:t}){return r.a.createElement(We,{tooltip:e?"Query is shared":"Query is private",onClick:function(){t("acl",e?[]:[{groupId:"__EVERYONE__",write:!0}])}},e?r.a.createElement(Sr.a,null):r.a.createElement(qr.a,null))})));const _r={flexShrink:0,flexGrow:1,width:8},Nr={flexShrink:0,width:8};var Rr=function({grow:e}){return e?r.a.createElement("div",{style:_r}):r.a.createElement("div",{style:Nr})},Lr=n(182),Dr=n.n(Lr);var Ar=Object(o.connect)((function(e){return{tags:e.query&&e.query.tags||[]}}),{setQueryState:la})(r.a.memo((function({tags:e,visible:t,onClose:n,setQueryState:a}){const l=(Object(i.b)(t?"/api/tags":null).data||[]).map(e=>({name:e,id:e})),c=e.map(e=>({name:e,id:e}));return r.a.createElement(Tt,{title:"Query tags",width:"600px",visible:t,onClose:n},r.a.createElement(Ln,{selectedItems:c,options:l,onChange:e=>{a("tags",e.map(e=>e.name))}}))})));var Br=function(){const e=Object(a.useState)(!1),t=Object(s.a)(e,2),n=t[0],l=t[1];return r.a.createElement("div",null,r.a.createElement(We,{tooltip:"Tags",onClick:()=>l(!0)},r.a.createElement(Dr.a,null)),r.a.createElement(Ar,{visible:n,onClose:()=>l(!1)}))},Qr=n(183),zr=n.n(Qr);var Fr=r.a.memo((function(){const e=ka().toggleSchema;return r.a.createElement(We,{tooltip:"Toggle schema",onClick:e},r.a.createElement(zr.a,null))}));var Ur=r.a.memo((function(){return r.a.createElement("div",{style:{width:"100%",backgroundColor:"rgba(0, 0, 0, 0.04)",padding:6,borderBottom:"1px solid rgb(204, 204, 204)"}},r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(Fr,null),r.a.createElement($a,null),r.a.createElement(Rr,null),r.a.createElement(hr,null),r.a.createElement(Rr,{grow:!0}),r.a.createElement(gr,null),r.a.createElement(Rr,null),r.a.createElement(Br,null),r.a.createElement(ur,null),r.a.createElement(Er,null),r.a.createElement(Tr,null),r.a.createElement(Or,null),r.a.createElement(Rr,{grow:!0}),r.a.createElement(Rr,null),r.a.createElement(vr,null),r.a.createElement(Rr,null),r.a.createElement(ir,null)))}));function Pr({value:e}){const t=Object(a.useState)({width:-1,height:-1}),n=Object(s.a)(t,2),l=n[0],c=n[1],i=l.width,o=l.height,u="".concat(i).concat(o);return r.a.createElement(ln.a,{bounds:!0,onResize:e=>c(e.bounds)},({measureRef:t})=>r.a.createElement("div",{ref:t,className:"h-100 w-100"},r.a.createElement(Qn.diff,{key:u,focus:!1,editorProps:{$blockScrolling:1/0},height:"".concat(o,"px"),mode:"sql",name:"query-diff-ace-editor",theme:"sqlserver",readOnly:!0,value:e,width:"".concat(i,"px")})))}n(142),n(143),Pr.defaultProps={value:["",""]};var Mr=Pr;var Wr=Object(o.connect)((function(e,t){return{queryText:e.query&&e.query.queryText}}),{setQueryState:la})((function({queryId:e,queryText:t,setQueryState:n}){const l=Object(a.useState)(!1),c=Object(s.a)(l,2),i=c[0],o=c[1],u=Object(a.useState)(""),d=Object(s.a)(u,2),m=d[0],p=d[1];Object(a.useEffect)(()=>{Xn(e).then(e=>{"string"===typeof e&&""!==e.trim()&&(o(!0),p(e))})},[e]);const f=[t,m];return r.a.createElement(Tt,{title:"Found unsaved query",visible:i,width:"90vw"},r.a.createElement("div",{style:{display:"flex",margin:8,justifyContent:"space-around"}},r.a.createElement(R,{onClick:()=>{o(!1)}},"Use saved"),r.a.createElement(R,{onClick:()=>{o(!1),Kn(e),n("queryText",m)}},"Use unsaved")),r.a.createElement("div",{style:{width:"100%",height:"60vh"}},r.a.createElement(Mr,{key:JSON.stringify(f),value:f})))}));const Hr=Be()((function(e){const t=Se[e];t&&t.resize&&t.resize()}),700);var Gr=Object(o.connect)((function(e,t){return{showVis:e.query&&e.query.chart&&Boolean(e.query.chart.chartType)}}),e=>({connectConnectionClient:ut(e),loadQuery:ea,resetNewQuery:ra}))((function(e){const t=e.connectConnectionClient,n=e.loadQuery,l=e.queryId,c=e.resetNewQuery,i=e.showVis;function o(){Hr(l)}Object(a.useEffect)(()=>{"new"===l?(c(),t()):n(l).then(()=>t())},[t,l,c,n]);const s=ka().showSchema,u=i?r.a.createElement(Qe.a,{key:"editorAndVis",split:"vertical",defaultSize:"50%",maxSize:-200,onChange:o},r.a.createElement(Pa,null),r.a.createElement("div",{style:{position:"absolute"},className:"h-100 w-100"},r.a.createElement(Fa,null,r.a.createElement(za,null)))):r.a.createElement(Pa,null),d=r.a.createElement(Qe.a,{split:"horizontal",minSize:100,defaultSize:"60%",maxSize:-100,onChange:o},u,r.a.createElement("div",null,r.a.createElement(Va,null),r.a.createElement("div",{style:{position:"absolute",top:30,bottom:0,left:0,right:0}},r.a.createElement(Ua,null)))),m=s?r.a.createElement(Qe.a,{split:"vertical",minSize:150,defaultSize:280,maxSize:-100,onChange:o},r.a.createElement(Ba,null),d):d;return r.a.createElement("div",{style:{height:"100vh",width:"100%",display:"flex",flexDirection:"column"}},r.a.createElement(ya,null),r.a.createElement(Ur,null),r.a.createElement("div",{style:{position:"relative",flexGrow:1}},m),r.a.createElement(Wr,{queryId:l}),r.a.createElement(Qa,{queryId:l}),r.a.createElement(Ka,null),r.a.createElement(Oa,null))}));var Vr=function({queryId:e}){const t=Le(e),n=Object(s.a)(t,3),l=n[0],c=n[1],i=n[2];if(Object(a.useEffect)(()=>{document.title="SQLPad"},[]),i||!c)return r.a.createElement("div",{style:{display:"flex",height:"100vh",width:"100%",flexDirection:"column"}},r.a.createElement(me,null));const o=c.name,u=c.links,d=c.incomplete;return r.a.createElement("div",{style:{display:"flex",height:"100vh",width:"100%",flexDirection:"column",padding:"16px"}},r.a.createElement("div",{style:{height:"50px"}},r.a.createElement("span",{style:{fontSize:"1.5rem"}},o||""),r.a.createElement("div",{style:{float:"right"}},d&&r.a.createElement(ue,null),r.a.createElement(te,{links:u}))),r.a.createElement("div",{style:{display:"flex",flexGrow:1,height:"100%"}},r.a.createElement("div",{style:{position:"relative",width:"100%",height:"100%",border:"1px solid #CCC"}},r.a.createElement(mn,{isRunning:i,queryResult:c,queryError:l}))))},Yr=n(184),Xr=n.n(Yr),Kr=n(95),Jr=n.n(Kr);var Zr=e=>{let t=e.className,n=e.children,a=e.icon,l=e.tooltip,c=e.to,i=e.href,o=e.variant,s=Object(I.a)(e,["className","children","icon","tooltip","to","href","variant"]);const u=[Jr.a.btnLink];let d;return"primary"===o?u.push(Jr.a.primary):"ghost"===o&&u.push(Jr.a.ghost),t&&u.push(t),d=i?r.a.createElement("a",Object.assign({href:i,className:u.join(" ")},s),a&&r.a.cloneElement(a,{size:20},null),n&&a&&r.a.createElement("span",{style:{width:4}}),n):r.a.createElement(E.b,Object.assign({to:c,className:u.join(" ")},s),a&&r.a.cloneElement(a,{size:20},null),n&&a&&r.a.createElement("span",{style:{width:4}}),n),l?r.a.createElement(N,{label:l},r.a.createElement("span",null,d)):d};var $r=function(){const e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],l=t[1],c=Object(a.useState)(""),o=Object(s.a)(c,2),u=o[0],d=o[1],m=Object(a.useState)(!1),p=Object(s.a)(m,2),f=p[0],b=p[1],g=j(),x=g.config,C=g.currentUser;Object(a.useEffect)(()=>{document.title="SQLPad - Sign In"},[]);const k=function(){var e=Object(w.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,P.post("/api/signin",{email:n,password:u});case 3:if(!e.sent.error){e.next=6;break}return e.abrupt("return",h("Username or password incorrect"));case 6:return e.next=8,Object(i.c)("api/app");case 8:b(!0);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();if(f&&C)return r.a.createElement(y.a,{push:!0,to:"/"});if(!x)return;const O=r.a.createElement("form",{onSubmit:k},r.a.createElement(A,{name:"email",type:"email",placeholder:x.ldapConfigured?"Username or e-mail address":"e-mail address",onChange:e=>l(e.target.value),required:!0}),r.a.createElement(B,null),r.a.createElement(A,{name:"password",type:"password",placeholder:"Password",onChange:e=>d(e.target.value),required:!0}),r.a.createElement(B,{size:2}),r.a.createElement(R,{style:{width:"100%"},onClick:k,htmlType:"submit",variant:"primary"},"Sign in"),r.a.createElement(B,null),r.a.createElement(E.b,{style:{display:"inline-block",width:"100%",textAlign:"center"},to:"/signup"},"Sign Up"),x.smtpConfigured?r.a.createElement(E.b,{to:"/forgot-password"},"Forgot Password"):null),S=r.a.createElement("div",null,r.a.createElement("a",{href:x.baseUrl+"/auth/google"},r.a.createElement(R,{variant:"primary"},r.a.createElement(Xr.a,null),"Sign in with Google"))),I=r.a.createElement("div",null,r.a.createElement("a",{href:x.baseUrl+"/auth/saml"},r.a.createElement("span",{dangerouslySetInnerHTML:{__html:x.samlLinkHtml}}))),q=r.a.createElement("div",null,r.a.createElement(B,null),r.a.createElement(Zr,{variant:"primary",style:{width:"100%",textAlign:"center"},href:x.baseUrl+"/auth/oidc"},r.a.createElement("div",{className:"w-100",dangerouslySetInnerHTML:{__html:x.oidcLinkHtml}})));return r.a.createElement("div",{style:{width:"300px",textAlign:"center",margin:"100px auto"}},r.a.createElement("h1",null,"SQLPad"),x.localAuthConfigured&&O,x.googleAuthConfigured&&S,x.samlConfigured&&I,x.oidcConfigured&&q)};var el=function(){const e=j().adminRegistrationOpen,t=Object(a.useState)(""),n=Object(s.a)(t,2),l=n[0],c=n[1],i=Object(a.useState)(""),o=Object(s.a)(i,2),u=o[0],d=o[1],m=Object(a.useState)(""),p=Object(s.a)(m,2),f=p[0],b=p[1],E=Object(a.useState)(!1),g=Object(s.a)(E,2),x=g[0],C=g[1];Object(a.useEffect)(()=>{document.title="SQLPad - Sign Up"},[]);const k=function(){var e=Object(w.a)(v.a.mark((function e(t){var n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n={email:l,password:u,passwordConfirmation:f},e.next=4,P.post("/api/signup",n);case 4:if(!(a=e.sent).error){e.next=7;break}return e.abrupt("return",h(a.error));case 7:C(!0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return x?r.a.createElement(y.a,{to:"/"}):r.a.createElement("div",{style:{width:"300px",textAlign:"center",margin:"100px auto"}},r.a.createElement("form",{onSubmit:k},r.a.createElement("h1",null,"SQLPad"),e&&r.a.createElement("div",null,r.a.createElement("h2",null,"Admin registration open"),r.a.createElement("p",null,"Welcome to SQLPad! Since there are no admins currently registered, signup is open to anyone. By signing up, you will be granted admin rights, and signup will be restricted to added email addresses and allowed domains")),r.a.createElement(A,{name:"email",type:"email",placeholder:"Email address",onChange:e=>c(e.target.value),required:!0}),r.a.createElement(B,null),r.a.createElement(A,{name:"password",type:"password",placeholder:"Password",onChange:e=>d(e.target.value),required:!0}),r.a.createElement(B,null),r.a.createElement(A,{name:"passwordConfirmation",type:"password",placeholder:"Confirm Password",onChange:e=>b(e.target.value),required:!0}),r.a.createElement(B,{size:2}),r.a.createElement(R,{style:{width:"100%"},htmlType:"submit",variant:"primary"},"Sign up")))};var tl=function(){const e=j(),t=e.config,n=e.currentUser;if(!t)return null;function a(){return n?r.a.createElement(y.a,{to:"/queries/new"}):r.a.createElement(y.a,{to:"/signin"})}return r.a.createElement(E.a,{basename:t.baseUrl},r.a.createElement(y.d,null,r.a.createElement(y.b,{exact:!0,path:"/",render:a}),r.a.createElement(y.b,{exact:!0,path:"/queries",render:a}),r.a.createElement(y.b,{exact:!0,path:"/queries/:queryId",render:({match:e})=>r.a.createElement(S,null,r.a.createElement(Gr,{queryId:e.params.queryId}))}),r.a.createElement(y.b,{exact:!0,path:"/query-table/:queryId",render:({match:e})=>r.a.createElement(Vr,{queryId:e.params.queryId})}),r.a.createElement(y.b,{exact:!0,path:"/query-chart/:queryId",render:({match:e})=>r.a.createElement(De,{queryId:e.params.queryId})}),r.a.createElement(y.b,{exact:!0,path:"/signin",render:()=>r.a.createElement($r,null)}),r.a.createElement(y.b,{exact:!0,path:"/signup",render:()=>r.a.createElement(el,null)}),r.a.createElement(y.b,{exact:!0,path:"/forgot-password",render:()=>r.a.createElement(M,null)}),r.a.createElement(y.b,{exact:!0,path:"/password-reset/:passwordResetId",render:({match:e})=>r.a.createElement(G,{passwordResetId:e.params.passwordResetId})}),r.a.createElement(y.b,{exact:!0,path:"/password-reset",render:()=>r.a.createElement(V,null)}),r.a.createElement(y.b,{render:()=>r.a.createElement(H,null)})))},nl=n(185);var al=Object(nl.a)(Object(Te.a)({},sa.initialState,{},pt));function rl(){return(rl=Object(w.a)(v.a.mark((function e(t){var n,a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.get(t);case 2:if(n=e.sent,a=n.data,!(r=n.error)){e.next=7;break}throw r;case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.a.render(r.a.createElement(o.Provider,{store:al},r.a.createElement(xa,null,r.a.createElement(i.a,{value:{fetcher:function(e){return rl.apply(this,arguments)}}},r.a.createElement(tl,null),r.a.createElement(f,null)))),document.getElementById("root"))},36:function(e,t,n){e.exports={ListItem:"QueryList_ListItem__5gFWQ",listItemActions:"QueryList_listItemActions__1Sovi",filterContainer:"QueryList_filterContainer__1_M9i",filterRow:"QueryList_filterRow__1eHeh",queryLink:"QueryList_queryLink__1IQgY",newWindowLink:"QueryList_newWindowLink__3_rsr"}},46:function(e,t,n){e.exports={btn:"IconButton_btn__3N2u3",danger:"IconButton_danger__1gWHL",ghost:"IconButton_ghost__3hQjv"}},47:function(e,t,n){e.exports={container:"MultiSelect_container__29u1v",input:"MultiSelect_input__1gHcG",item:"MultiSelect_item__2AGAk",itemActive:"MultiSelect_itemActive__3IYl8",itemSelected:"MultiSelect_itemSelected__5E-XZ",menu:"MultiSelect_menu__16yv-"}},67:function(e,t,n){e.exports={Dialog:"DeleteConfirmButton_Dialog__1fK1F",dialogContent:"DeleteConfirmButton_dialogContent__W3Sh_",buttonWrapper:"DeleteConfirmButton_buttonWrapper__DqUmO",button:"DeleteConfirmButton_button__1JfWZ"}},68:function(e,t,n){e.exports={schema:"SchemaSidebar_schema__HZ9RS",table:"SchemaSidebar_table__13TE5",column:"SchemaSidebar_column__126R4",schemaSpinner:"SchemaSidebar_schemaSpinner__An3e8"}},74:function(e,t,n){e.exports={btn:"Button_btn__2jK9g",primary:"Button_primary__f5uu3",danger:"Button_danger__ClkBS",ghost:"Button_ghost__2TMAY"}},92:function(e,t,n){e.exports={Dialog:"Drawer_Dialog__3ZE53",titleWrapper:"Drawer_titleWrapper__jSTRe",dialogBody:"Drawer_dialogBody__1EzlJ"}},93:function(e,t,n){e.exports={Dialog:"Modal_Dialog__3In5b",titleWrapper:"Modal_titleWrapper__dT84L",dialogBody:"Modal_dialogBody__M4L7o"}},94:function(e,t,n){e.exports={tagContainer:"Tag_tagContainer__axqx_",tagCloseButton:"Tag_tagCloseButton__B-L1R",CloseIcon:"Tag_CloseIcon__QszSK"}},95:function(e,t,n){e.exports={btnLink:"ButtonLink_btnLink__22PEA",primary:"ButtonLink_primary__1la94",ghost:"ButtonLink_ghost__29Tln"}}},[[194,1,2]]]);
//# sourceMappingURL=main.cf6bd0c5.chunk.js.map